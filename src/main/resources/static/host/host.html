<!DOCTYPE html>
<html lang="vi">
<head>
	<meta charset="UTF-8">
	<title>Host - OpenEvent</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			max-width: 800px;
			margin: 0 auto;
			padding: 20px;
		}
		.role-switch {
			background-color: #007bff;
			color: white;
			border: none;
			padding: 10px 20px;
			border-radius: 5px;
			cursor: pointer;
			margin: 10px 0;
		}
		.role-switch:hover {
			background-color: #0056b3;
		}
		.current-role {
			font-weight: bold;
			color: #28a745;
		}
		.host-features {
			background-color: #f8f9fa;
			padding: 20px;
			border-radius: 5px;
			margin: 20px 0;
		}
	</style>
</head>
<body>
	<h1>Trang Host</h1>
	<p>Xin chào <span class="current-role" id="currentRole">HOST</span>.</p>
	
	<div class="host-features">
		<h3>Tính năng Host:</h3>
		<ul>
			<li>Tạo và quản lý sự kiện</li>
			<li>Xem thống kê sự kiện</li>
			<li>Quản lý người tham gia</li>
			<li>Chuyển đổi giữa User và Host</li>
		</ul>
	</div>
	
	<button class="role-switch" onclick="switchRole()" id="switchButton">
		Chuyển thành User
	</button>
	
	<p><a href="/">Back to Home</a></p>

	<script>
		function switchRole() {
			fetch('/api/switch-role', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				}
			})
			.then(response => response.text())
			.then(data => {
				if (data === 'Role switched successfully') {
					// Reload trang để cập nhật role
					location.reload();
				} else {
					alert('Lỗi: ' + data);
				}
			})
			.catch(error => {
				console.error('Error:', error);
				alert('Có lỗi xảy ra khi chuyển đổi role');
			});
		}

		function updateUI(userInfo) {
			const currentRoleElement = document.getElementById('currentRole');
			const switchButton = document.getElementById('switchButton');
			
			currentRoleElement.textContent = userInfo.role;
			
			if (userInfo.role === 'USER') {
				switchButton.textContent = 'Chuyển thành Host';
			} else if (userInfo.role === 'HOST') {
				switchButton.textContent = 'Chuyển thành User';
			} else {
				switchButton.style.display = 'none';
			}
		}

		// Cập nhật giao diện dựa trên role hiện tại
		window.onload = function() {
			fetch('/api/current-user')
				.then(response => response.json())
				.then(data => {
					if (data.error) {
						console.error('Error:', data.error);
						// Redirect to login if not authenticated
						window.location.href = '/security/login.html';
					} else {
						updateUI(data);
					}
				})
				.catch(error => {
					console.error('Error:', error);
					// Redirect to login if error
					window.location.href = '/security/login.html';
				});
		};
	</script>
</body>
</html>
