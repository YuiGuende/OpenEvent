<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenEvent Admin Dashboard</title>
    <meta name="description" content="OpenEvent Platform Admin Dashboard - Monitoring & Reporting">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Admin Dashboard CSS -->
    <link rel="stylesheet" href="/css/admin-dashboard.css">
</head>
<body>
<!-- Mobile Menu Toggle -->
<button class="mobile-menu-toggle" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
</button>

<!-- Sidebar -->
<nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h3><i class="fas fa-chart-line"></i> OpenEvent Admin</h3>
    </div>
    <div class="sidebar-menu">
        <a class="menu-item active" onclick="showPage('dashboard')">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </a>
        <a class="menu-item" onclick="toggleSubmenu('reports')">
            <i class="fas fa-chart-bar"></i>
            <span>Monitoring & Reporting</span>
            <i class="fas fa-chevron-down ms-auto"></i>
        </a>
        <div class="submenu" id="reports-submenu">
            <a class="submenu-item" onclick="showPage('financial')">
                <i class="fas fa-dollar-sign"></i> Financial Reports
            </a>
            <a class="submenu-item" onclick="showPage('events')">
                <i class="fas fa-calendar-alt"></i> Event Operations
            </a>
            <a class="submenu-item" onclick="showPage('users')">
                <i class="fas fa-users"></i> User Activity
            </a>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="main-content">
    <!-- Dashboard Page -->
    <section id="dashboard" class="page-section active">
        <div class="page-header">
            <h1>Overview Dashboard</h1>
            <p>Monitor OpenEvent platform performance and operations</p>
        </div>

        <!-- KPI Cards -->
        <div class="row g-4 mb-4">
            <div class="col-md-6 col-lg-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <span class="kpi-title-text">Total Revenue</span>
                        </div>
                    </div>
                    <h3 id="totalRevenue">0</h3>
                    <p class="kpi-subtitle">Total system revenue</p>
                    <span class="trend up" id="revenueTrend"><i class="fas fa-arrow-up"></i> 0%</span>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <span class="kpi-title-text">Active Events</span>
                        </div>
                    </div>
                    <h3 id="activeEvents">0</h3>
                    <p class="kpi-subtitle">Currently active events</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <span class="kpi-title-text">New Users</span>
                        </div>
                    </div>
                    <h3 id="newUsers">0</h3>
                    <p class="kpi-subtitle">New users (30 days)</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <span class="kpi-title-text">Pending Approval Requests</span>
                        </div>
                    </div>
                    <h3 id="pendingRequests">0</h3>
                    <p class="kpi-subtitle">Requests awaiting approval</p>
                </div>
            </div>
        </div>

        <hr>

        <!-- Quick Stats Charts -->
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="chart-container">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="mb-0">Revenue Trend</h2>
                    </div>
                    <div class="chart-filters">
                        <button class="chart-filter-btn active" onclick="filterChart('revenueOverview', 'day')">Day</button>
                        <button class="chart-filter-btn" onclick="filterChart('revenueOverview', 'month')">Month</button>
                        <button class="chart-filter-btn" onclick="filterChart('revenueOverview', 'year')">Year</button>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="revenueOverviewChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="chart-container">
                    <h2>Event Distribution by Type</h2>
                    <div class="chart-wrapper small">
                        <canvas id="eventTypeChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity Table -->
        <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>Recent Activity</h2>
            </div>
            <table class="table">
                <thead>
                <tr>
                    <th>Time</th>
                    <th>User</th>
                    <th>Action</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody id="recentActivityBody">
                <tr>
                    <td colspan="4" class="text-center text-muted">Loading data...</td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- Financial Reports Page -->
    <section id="financial" class="page-section">
        <div class="page-header">
            <h1>Financial Reports</h1>
            <p>Detailed analysis of revenue and service fees</p>
        </div>

        <hr>

        <!-- Financial Summary KPI Cards -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <span class="kpi-title-text">Total Revenue</span>
                        </div>
                    </div>
                    <h3 id="financialTotalRevenue">0</h3>
                    <p class="kpi-subtitle" id="financialRevenuePeriod">All time</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <span class="kpi-title-text">Total Orders</span>
                        </div>
                    </div>
                    <h3 id="financialTotalOrders">0</h3>
                    <p class="kpi-subtitle">Total number of orders</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <span class="kpi-title-text">Average Order Value</span>
                        </div>
                    </div>
                    <h3 id="financialAvgOrderValue">0</h3>
                    <p class="kpi-subtitle">Average per order</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <span class="kpi-title-text">Total Service Fees</span>
                        </div>
                    </div>
                    <h3 id="totalServiceFee">0</h3>
                    <p class="kpi-subtitle">Service fees collected</p>
                </div>
            </div>
        </div>

        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <span class="kpi-title-text">Host Payouts</span>
                        </div>
                    </div>
                    <h3 id="totalHostPayment">0</h3>
                    <p class="kpi-subtitle">Total payouts</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-coins"></i>
                            </div>
                            <span class="kpi-title-text">Net Profit</span>
                        </div>
                    </div>
                    <h3 id="financialNetProfit">0</h3>
                    <p class="kpi-subtitle">After expenses</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <span class="kpi-title-text">Pending Payments</span>
                        </div>
                    </div>
                    <h3 id="financialPendingPayments">0</h3>
                    <p class="kpi-subtitle">Awaiting processing</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-undo"></i>
                            </div>
                            <span class="kpi-title-text">Refunded Amount</span>
                        </div>
                    </div>
                    <h3 id="financialRefundedAmount">0</h3>
                    <p class="kpi-subtitle">Total refunded</p>
                </div>
            </div>
        </div>

        <hr>

        <!-- Revenue Streams Analysis -->
        <div class="row g-4 mb-4">
            <div class="col-lg-6">
                <div class="chart-container">
                    <h2>Revenue Distribution by Source</h2>
                    <div class="chart-wrapper small">
                        <canvas id="revenueSourceChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="chart-container">
                    <h2>Revenue by Event Type</h2>
                    <div class="chart-wrapper small">
                        <canvas id="revenueByEventTypeChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <hr>

        <!-- Revenue Trend Chart -->
        <div class="chart-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">Revenue & Service Fee Trend</h2>
                <button class="btn btn-outline-primary" onclick="exportToCSV('revenue-data')">
                    <i class="fas fa-download"></i> Export CSV
                </button>
            </div>
            <div class="chart-filters">
                <button class="chart-filter-btn active" onclick="filterChart('revenueTrend', 'day', this)">Day</button>
                <button class="chart-filter-btn" onclick="filterChart('revenueTrend', 'month', this)">Month</button>
                <button class="chart-filter-btn" onclick="filterChart('revenueTrend', 'year', this)">Year</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="revenueTrendChart"></canvas>
            </div>
        </div>

        <hr>

        <!-- Order Management Table -->
        <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>Order Management</h2>
                <button class="btn btn-outline-primary" onclick="exportOrdersToCSV()">
                    <i class="fas fa-download"></i> Export CSV
                </button>
            </div>
            
            <!-- Order Filters -->
            <div class="filters mb-3">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="orderStatusFilter" onchange="loadOrders()">
                            <option value="">All</option>
                            <option value="PENDING">Pending</option>
                            <option value="PAID">Paid</option>
                            <option value="CANCELLED">Cancelled</option>
                            <option value="EXPIRED">Expired</option>
                            <option value="REFUNDED">Refunded</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">From Date</label>
                        <input type="date" class="form-control" id="orderFromDate" onchange="loadOrders()">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">To Date</label>
                        <input type="date" class="form-control" id="orderToDate" onchange="loadOrders()">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Search</label>
                        <input type="text" class="form-control" id="orderSearch" placeholder="ID, name, email..." onkeyup="debounceSearch('order')">
                    </div>
                </div>
            </div>
            
            <table class="table" id="orders-table">
                <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Event</th>
                    <th>Ticket Type</th>
                    <th>Quantity</th>
                    <th>Total Amount</th>
                    <th>Status</th>
                    <th>Payment</th>
                    <th>Created Date</th>
                </tr>
                </thead>
                <tbody id="ordersBody">
                <tr>
                    <td colspan="9" class="text-center text-muted">Loading data...</td>
                </tr>
                </tbody>
            </table>
            
            <!-- Pagination -->
            <nav aria-label="Orders pagination">
                <ul class="pagination justify-content-center" id="ordersPagination">
                </ul>
            </nav>
        </div>

        <hr>

        <!-- Payment Transactions Table -->
        <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>Payment Transactions</h2>
                <button class="btn btn-outline-primary" onclick="exportPaymentsToCSV()">
                    <i class="fas fa-download"></i> Export CSV
                </button>
            </div>
            
            <!-- Payment Filters -->
            <div class="filters mb-3">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="paymentStatusFilter" onchange="loadPayments()">
                            <option value="">All</option>
                            <option value="PENDING">Pending</option>
                            <option value="PAID">Paid</option>
                            <option value="CANCELLED">Cancelled</option>
                            <option value="EXPIRED">Expired</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">From Date</label>
                        <input type="date" class="form-control" id="paymentFromDate" onchange="loadPayments()">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">To Date</label>
                        <input type="date" class="form-control" id="paymentToDate" onchange="loadPayments()">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Search</label>
                        <input type="text" class="form-control" id="paymentSearch" placeholder="ID, Order ID, email..." onkeyup="debounceSearch('payment')">
                    </div>
                </div>
            </div>
            
            <table class="table" id="payments-table">
                <thead>
                <tr>
                    <th>Payment ID</th>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Amount</th>
                    <th>Payment Method</th>
                    <th>Status</th>
                    <th>Transaction ID</th>
                    <th>Created Date</th>
                    <th>Paid Date</th>
                </tr>
                </thead>
                <tbody id="paymentsBody">
                <tr>
                    <td colspan="9" class="text-center text-muted">Loading data...</td>
                </tr>
                </tbody>
            </table>
            
            <!-- Pagination -->
            <nav aria-label="Payments pagination">
                <ul class="pagination justify-content-center" id="paymentsPagination">
                </ul>
            </nav>
        </div>

        <hr>

        <!-- Host Payouts Table -->
        <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>Recent Host Payouts</h2>
                <button class="btn btn-outline-primary" onclick="exportToCSV('payout-data')">
                    <i class="fas fa-download"></i> Export CSV
                </button>
            </div>
            <table class="table" id="payout-data">
                <thead>
                <tr>
                    <th>Host ID</th>
                    <th>Host Name</th>
                    <th>Amount</th>
                    <th>Transaction Date</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody id="payoutBody">
                <tr>
                    <td colspan="5" class="text-center text-muted">Loading data...</td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- Event Operations Page -->
    <section id="events" class="page-section">
        <div class="page-header">
            <h1>Event Operations Management</h1>
            <p>Comprehensive event management and analytics</p>
        </div>

        <hr>

        <!-- Pending Approval Requests -->
        <div class="table-container mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-clock"></i> Pending Approval Requests</h2>
                <button class="btn btn-sm btn-outline-primary" onclick="loadPendingApprovals()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-hover" id="pendingApprovalsTable">
                    <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAllPending" onchange="toggleSelectAll('pending')"></th>
                        <th>Event</th>
                        <th>Type</th>
                        <th>Host</th>
                        <th>Department</th>
                        <th>Days Pending</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="pendingApprovalsBody">
                    <tr>
                        <td colspan="7" class="text-center text-muted">Loading...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-2">
                <div>
                    <button class="btn btn-sm btn-success" onclick="bulkApproveSelected()">
                        <i class="fas fa-check"></i> Approve Selected
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="bulkRejectSelected()">
                        <i class="fas fa-times"></i> Reject Selected
                    </button>
                </div>
                <nav id="pendingApprovalsPagination"></nav>
            </div>
        </div>

        <hr>

        <!-- Event Status Management -->
        <div class="table-container mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-list-alt"></i> Event Status Management</h2>
                <div class="d-flex gap-2">
                    <select class="form-select form-select-sm" id="eventStatusFilter" onchange="loadEventsByStatus()">
                        <option value="">All Status</option>
                        <option value="DRAFT">Draft</option>
                        <option value="PUBLIC">Public</option>
                        <option value="ONGOING">Ongoing</option>
                        <option value="FINISH">Finished</option>
                        <option value="CANCEL">Cancelled</option>
                    </select>
                    <select class="form-select form-select-sm" id="eventTypeFilter" onchange="loadEventsByStatus()">
                        <option value="">All Types</option>
                        <option value="MUSIC">Music</option>
                        <option value="WORKSHOP">Workshop</option>
                        <option value="COMPETITION">Competition</option>
                        <option value="FESTIVAL">Festival</option>
                        <option value="OTHERS">Others</option>
                    </select>
                    <input type="text" class="form-control form-control-sm" id="eventSearchFilter" placeholder="Search..." onkeyup="loadEventsByStatus()">
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover" id="eventsByStatusTable">
                    <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAllEvents" onchange="toggleSelectAll('events')"></th>
                        <th>Event</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Department</th>
                        <th>Start Date</th>
                        <th>Registered</th>
                        <th>Revenue</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="eventsByStatusBody">
                    <tr>
                        <td colspan="9" class="text-center text-muted">Loading...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <nav id="eventsByStatusPagination" class="mt-2"></nav>
        </div>

        <hr>

        <!-- Upcoming Events -->
        <div class="table-container mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-calendar-alt"></i> Upcoming Events</h2>
                <div class="d-flex gap-2 align-items-center">
                    <label>Days:</label>
                    <select class="form-select form-select-sm" id="upcomingDaysFilter" onchange="loadUpcomingEvents()">
                        <option value="7">Next 7 days</option>
                        <option value="30" selected>Next 30 days</option>
                        <option value="60">Next 60 days</option>
                    </select>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>Event</th>
                        <th>Type</th>
                        <th>Start Date</th>
                        <th>Venue</th>
                        <th>Registered/Capacity</th>
                        <th>Fill Rate</th>
                        <th>Department</th>
                    </tr>
                    </thead>
                    <tbody id="upcomingEventsBody">
                    <tr>
                        <td colspan="7" class="text-center text-muted">Loading...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <nav id="upcomingEventsPagination" class="mt-2"></nav>
        </div>

        <hr>

        <!-- Department Statistics -->
        <div class="table-container mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-building"></i> Department Event Statistics</h2>
                <button class="btn btn-sm btn-outline-primary" onclick="loadDepartmentStats()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <div class="chart-container">
                        <h3>Events by Department</h3>
                        <div class="chart-wrapper small">
                            <canvas id="departmentEventsChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <h3>Revenue by Department</h3>
                        <div class="chart-wrapper small">
                            <canvas id="departmentRevenueChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>Department</th>
                        <th>Total Events</th>
                        <th>Active Events</th>
                        <th>Pending Approval</th>
                        <th>Completed</th>
                        <th>Total Revenue</th>
                        <th>Total Participants</th>
                    </tr>
                    </thead>
                    <tbody id="departmentStatsBody">
                    <tr>
                        <td colspan="7" class="text-center text-muted">Loading...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <hr>

        <!-- Attendance Statistics -->
        <div class="table-container mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-users"></i> Attendance & Participation Tracking</h2>
                <div class="d-flex gap-2">
                    <select class="form-select form-select-sm" id="attendanceEventTypeFilter" onchange="loadAttendanceStats()">
                        <option value="">All Types</option>
                        <option value="MUSIC">Music</option>
                        <option value="WORKSHOP">Workshop</option>
                        <option value="COMPETITION">Competition</option>
                        <option value="FESTIVAL">Festival</option>
                    </select>
                </div>
            </div>
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <div class="chart-container">
                        <h3>Attendance Rate by Event Type</h3>
                        <div class="chart-wrapper small">
                            <canvas id="attendanceRateChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <h3>Check-in vs No-show</h3>
                        <div class="chart-wrapper small">
                            <canvas id="checkinChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>Event</th>
                        <th>Type</th>
                        <th>Start Date</th>
                        <th>Total Registered</th>
                        <th>Checked In</th>
                        <th>No Show</th>
                        <th>Attendance Rate</th>
                    </tr>
                    </thead>
                    <tbody id="attendanceStatsBody">
                    <tr>
                        <td colspan="7" class="text-center text-muted">Loading...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <nav id="attendanceStatsPagination" class="mt-2"></nav>
        </div>

        <hr>

        <!-- Venue Conflicts -->
        <div class="table-container mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-exclamation-triangle"></i> Venue Conflict Detection</h2>
                <button class="btn btn-sm btn-outline-warning" onclick="loadVenueConflicts()">
                    <i class="fas fa-sync"></i> Check Conflicts
                </button>
            </div>
            <div id="venueConflictsAlert" class="alert alert-warning" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i> <span id="conflictsCount">0</span> conflicts detected
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>Venue</th>
                        <th>Event 1</th>
                        <th>Event 2</th>
                        <th>Overlap Time</th>
                        <th>Severity</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="venueConflictsBody">
                    <tr>
                        <td colspan="6" class="text-center text-muted">No conflicts detected</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <hr>

        <!-- Points Tracking -->
        <div class="table-container mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-star"></i> Points & Learning Outcomes Tracking</h2>
                <div class="d-flex gap-2">
                    <select class="form-select form-select-sm" id="pointsEventTypeFilter" onchange="loadPointsTracking()">
                        <option value="">All Types</option>
                        <option value="MUSIC">Music</option>
                        <option value="WORKSHOP">Workshop</option>
                        <option value="COMPETITION">Competition</option>
                        <option value="FESTIVAL">Festival</option>
                    </select>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>Event</th>
                        <th>Type</th>
                        <th>Points Awarded</th>
                        <th>Students Earned</th>
                        <th>Total Participants</th>
                        <th>Distribution Rate</th>
                        <th>Learning Objectives</th>
                    </tr>
                    </thead>
                    <tbody id="pointsTrackingBody">
                    <tr>
                        <td colspan="7" class="text-center text-muted">Loading...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <nav id="pointsTrackingPagination" class="mt-2"></nav>
        </div>

        <hr>

        <!-- Speaker Statistics -->
        <div class="table-container mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-microphone"></i> Speaker Management</h2>
                <button class="btn btn-sm btn-outline-primary" onclick="loadSpeakerStats()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <div class="chart-container">
                        <h3>Top Speakers by Events</h3>
                        <div class="chart-wrapper small">
                            <canvas id="speakerEventsChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <h3>Speaker Performance</h3>
                        <div class="chart-wrapper small">
                            <canvas id="speakerPerformanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>Speaker</th>
                        <th>Role</th>
                        <th>Events Count</th>
                        <th>Total Participants</th>
                        <th>Total Revenue</th>
                    </tr>
                    </thead>
                    <tbody id="speakerStatsBody">
                    <tr>
                        <td colspan="5" class="text-center text-muted">Loading...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <nav id="speakerStatsPagination" class="mt-2"></nav>
        </div>

        <hr>

        <!-- Event Performance Metrics -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <span class="kpi-title-text">Registration Rate</span>
                        </div>
                    </div>
                    <h3 id="registrationRate">0%</h3>
                    <p class="kpi-subtitle">Conversion rate</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <span class="kpi-title-text">Attendance Rate</span>
                        </div>
                    </div>
                    <h3 id="attendanceRateKPI">0%</h3>
                    <p class="kpi-subtitle">Check-in rate</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <span class="kpi-title-text">Revenue per Event</span>
                        </div>
                    </div>
                    <h3 id="revenuePerEvent">$0</h3>
                    <p class="kpi-subtitle">Average revenue</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <span class="kpi-title-text">Cost per Participant</span>
                        </div>
                    </div>
                    <h3 id="costPerParticipant">$0</h3>
                    <p class="kpi-subtitle">Average cost</p>
                </div>
            </div>
        </div>

        <!-- Event Distribution Charts (Keep existing) -->
        <div class="row g-4 mb-4">
            <div class="col-lg-5">
                <div class="chart-container">
                    <h2>Event Distribution by Type</h2>
                    <div class="chart-wrapper small">
                        <canvas id="eventDistributionChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-7">
                <div class="chart-container">
                    <h2>Event Approval Rate</h2>
                    <div class="chart-wrapper">
                        <canvas id="approvalRateChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <hr>

        <!-- Top Performing Events (Keep existing) -->
        <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>Top 10 Highest Performing Events</h2>
                <button class="btn btn-outline-primary" onclick="exportToCSV('top-events')">
                    <i class="fas fa-download"></i> Export CSV
                </button>
            </div>
            <table class="table" id="top-events">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Event Name</th>
                    <th>Host</th>
                    <th>Type</th>
                    <th>Tickets Sold</th>
                    <th>Revenue</th>
                </tr>
                </thead>
                <tbody id="topEventsBody">
                <tr>
                    <td colspan="6" class="text-center text-muted">Loading data...</td>
                </tr>
                </tbody>
            </table>
        </div>

        <hr>

        <!-- Event Statistics (Keep existing) -->
        <div class="row g-4">
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <span class="kpi-title-text">Approved Events</span>
                        </div>
                    </div>
                    <h3 id="approvedEvents">0</h3>
                    <p class="kpi-subtitle">Rate: <span id="approvedRate">0%</span></p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <span class="kpi-title-text">Rejected Events</span>
                        </div>
                    </div>
                    <h3 id="rejectedEvents">0</h3>
                    <p class="kpi-subtitle">Rate: <span id="rejectedRate">0%</span></p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-ticket-alt"></i>
                            </div>
                            <span class="kpi-title-text">Total Tickets Sold</span>
                        </div>
                    </div>
                    <h3 id="totalTicketsSold">0</h3>
                    <p class="kpi-subtitle">Total tickets sold</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <span class="kpi-title-text">Average Rating</span>
                        </div>
                    </div>
                    <h3 id="avgRating">0/5.0</h3>
                    <p class="kpi-subtitle">Average rating</p>
                </div>
            </div>
        </div>
    </section>

    <!-- User Activity Page -->
    <section id="users" class="page-section">
        <div class="page-header">
            <h1>User Activity Report</h1>
            <p>Comprehensive user statistics, activity tracking, and engagement analysis</p>
        </div>

        <hr>

        <!-- User Statistics KPI Cards -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <span class="kpi-title-text">Total Users</span>
                        </div>
                    </div>
                    <h3 id="userStatsTotalUsers">0</h3>
                    <p class="kpi-subtitle">All registered users</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-user-friends"></i>
                            </div>
                            <span class="kpi-title-text">Active Users (30d)</span>
                        </div>
                    </div>
                    <h3 id="userStatsActiveUsers">0</h3>
                    <p class="kpi-subtitle">Active in last 30 days</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <span class="kpi-title-text">New This Month</span>
                        </div>
                    </div>
                    <h3 id="userStatsNewUsers">0</h3>
                    <p class="kpi-subtitle">New registrations</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <span class="kpi-title-text">Retention Rate</span>
                        </div>
                    </div>
                    <h3 id="userStatsRetentionRate">0%</h3>
                    <p class="kpi-subtitle">User retention</p>
                </div>
            </div>
        </div>

        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <span class="kpi-title-text">Daily Active (DAU)</span>
                        </div>
                    </div>
                    <h3 id="userStatsDAU">0</h3>
                    <p class="kpi-subtitle">Last 24 hours</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-calendar-week"></i>
                            </div>
                            <span class="kpi-title-text">Weekly Active (WAU)</span>
                        </div>
                    </div>
                    <h3 id="userStatsWAU">0</h3>
                    <p class="kpi-subtitle">Last 7 days</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <span class="kpi-title-text">Monthly Active (MAU)</span>
                        </div>
                    </div>
                    <h3 id="userStatsMAU">0</h3>
                    <p class="kpi-subtitle">Last 30 days</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card">
                    <div class="kpi-card-header">
                        <div class="kpi-card-title">
                            <div class="kpi-icon">
                                <i class="fas fa-comment-dots"></i>
                            </div>
                            <span class="kpi-title-text">Total Feedback</span>
                        </div>
                    </div>
                    <h3 id="userStatsFeedbackCount">0</h3>
                    <p class="kpi-subtitle">Feedback submissions</p>
                </div>
            </div>
        </div>

        <hr>

        <!-- Registration Trend Chart -->
        <div class="chart-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">User Registration Trend</h2>
            </div>
            <div class="chart-filters">
                <button class="chart-filter-btn active" onclick="filterChart('registrationTrend', 'day', this)">Day</button>
                <button class="chart-filter-btn" onclick="filterChart('registrationTrend', 'month', this)">Month</button>
                <button class="chart-filter-btn" onclick="filterChart('registrationTrend', 'year', this)">Year</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="registrationTrendChart"></canvas>
            </div>
        </div>

        <hr>

        <!-- User List Section -->
        <div class="table-container mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>User List</h2>
                <button class="btn btn-outline-primary" onclick="exportUsersToCSV()">
                    <i class="fas fa-download"></i> Export CSV
                </button>
            </div>
            
            <!-- User List Filters -->
            <div class="filters mb-3">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Role</label>
                        <select class="form-select" id="userRoleFilter" onchange="window.loadUsers(0)">
                            <option value="">All Roles</option>
                            <option value="CUSTOMER">Customer</option>
                            <option value="HOST">Host</option>
                            <option value="ADMIN">Admin</option>
                            <option value="DEPARTMENT">Department</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Search</label>
                        <input type="text" class="form-control" id="userSearchFilter" placeholder="Name or email..." onkeyup="debounceSearchCallback(() => window.loadUsers(0))">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">From Date</label>
                        <input type="date" class="form-control" id="userFromDateFilter" onchange="window.loadUsers(0)">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">To Date</label>
                        <input type="date" class="form-control" id="userToDateFilter" onchange="window.loadUsers(0)">
                    </div>
                </div>
            </div>
            
            <table class="table">
                <thead>
                <tr>
                    <th>User ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Registration Date</th>
                    <th>Last Activity</th>
                    <th>Total Events</th>
                    <th>Total Orders</th>
                    <th>Total Spent</th>
                    <th>Points</th>
                    <th>Feedback</th>
                </tr>
                </thead>
                <tbody id="userListBody">
                <tr>
                    <td colspan="11" class="text-center text-muted">Loading data...</td>
                </tr>
                </tbody>
            </table>
            <div id="userListPagination" class="pagination-container"></div>
        </div>

        <hr>

        <!-- Enhanced Audit Log Section -->
        <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>Enhanced Activity History</h2>
                <button class="btn btn-outline-primary" onclick="exportAuditLogsToCSV()">
                    <i class="fas fa-download"></i> Export CSV
                </button>
            </div>
            
            <!-- Audit Log Filters -->
            <div class="filters mb-3">
                <div class="row g-3">
                    <div class="col-md-2">
                        <label class="form-label">Action Type</label>
                        <select class="form-select" id="actionTypeFilter" onchange="window.loadEnhancedAuditLogs(0)">
                            <option value="">All</option>
                            <option value="EVENT_CREATED">Event Created</option>
                            <option value="EVENT_UPDATED">Event Updated</option>
                            <option value="EVENT_CANCELLED">Event Cancelled</option>
                            <option value="EVENT_APPROVED">Event Approved</option>
                            <option value="USER_CREATED">User Created</option>
                            <option value="ORDER_CREATED">Order Created</option>
                            <option value="ORDER_AUTO_CANCELLED">Order Auto-Cancelled</option>
                            <option value="PAYMENT_COMPLETED">Payment Completed</option>
                            <option value="PAYMENT_AUTO_CANCELLED">Payment Auto-Cancelled</option>
                            <option value="FEEDBACK_SUBMITTED">Feedback Submitted</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Entity Type</label>
                        <select class="form-select" id="entityTypeFilter" onchange="window.loadEnhancedAuditLogs(0)">
                            <option value="">All</option>
                            <option value="EVENT">Event</option>
                            <option value="ORDER">Order</option>
                            <option value="PAYMENT">Payment</option>
                            <option value="FEEDBACK">Feedback</option>
                            <option value="USER">User</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">User ID</label>
                        <input type="text" class="form-control" id="userIdFilter" placeholder="User ID..." onkeyup="debounceSearchCallback(() => window.loadEnhancedAuditLogs(0))">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Search</label>
                        <input type="text" class="form-control" id="auditLogSearchFilter" placeholder="Search description..." onkeyup="debounceSearchCallback(() => window.loadEnhancedAuditLogs(0))">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">From Date</label>
                        <input type="date" class="form-control" id="fromDateFilter" onchange="window.loadEnhancedAuditLogs(0)">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">To Date</label>
                        <input type="date" class="form-control" id="toDateFilter" onchange="window.loadEnhancedAuditLogs(0)">
                    </div>
                </div>
            </div>
            
            <table class="table">
                <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>User</th>
                    <th>Role</th>
                    <th>Action Type</th>
                    <th>Entity Type</th>
                    <th>Entity Details</th>
                    <th>Description</th>
                </tr>
                </thead>
                <tbody id="enhancedAuditLogBody">
                <tr>
                    <td colspan="7" class="text-center text-muted">Loading data...</td>
                </tr>
                </tbody>
            </table>
            <div id="enhancedAuditLogPagination" class="pagination-container"></div>
        </div>
    </section>
</main>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Admin Dashboard JavaScript -->
<script src="/js/admin-dashboard.js"></script>
</body>
</html>
