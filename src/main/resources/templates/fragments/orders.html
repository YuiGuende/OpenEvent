
<div class="container" th:fragment="content" th:attr="data-event-id=${eventId}">
    <style>
        .modal-backdrop {
            z-index: 1040 !important;
        }

        .modal {
            z-index: 1050 !important;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-paid {
            background-color: #d4edda;
            color: #155724;
        }

        .status-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }

        .status-expired {
            background-color: #e2e3e5;
            color: #6c757d;
        }

        .status-refunded {
            background-color: #cce5ff;
            color: #004085;
        }

        :root {
            --blue-primary: #3B82F6;
            --blue-secondary: #2563EB;
            --green-primary: #10B981;
            --green-secondary: #059669;
            --orange-primary: #FF6B35;
            --orange-secondary: #F7931E;
        }

        /* Orders page - Orange theme (thead) with Green buttons */
        .container {
            padding: 2rem;
        }

        .card {
            border: none;
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.1);
        }

        .card-body {
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
        }

        .status-option.active {
            background-color: var(--orange-primary) !important;
            color: white !important;
            border-color: var(--orange-primary) !important;
        }

        /* Status badges with consistent styling */
        .status-badge {
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .status-paid {
            background: linear-gradient(135deg, var(--green-primary), var(--green-secondary)) !important;
            color: white !important;
        }

        .status-pending {
            background: linear-gradient(135deg, var(--orange-primary), var(--orange-secondary)) !important;
            color: white !important;
        }

        /* Orders table - Orange gradient (tone chủ đạo) */
        .orders-table thead {
            background: linear-gradient(135deg, var(--orange-primary), var(--orange-secondary)) !important;
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.2);
        }

        .orders-table thead th {
            color: white !important;
            background: linear-gradient(135deg, var(--orange-primary), var(--orange-secondary)) !important;
            font-weight: 600 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
            border: none !important;
            padding: 1rem !important;
        }

        /* Buttons - Green (màu phụ) */
        .btn-outline-primary {
            border-color: var(--green-primary);
            color: var(--green-primary);
        }

        .btn-outline-primary:hover {
            background: var(--green-primary);
            border-color: var(--green-primary);
            color: white;
        }

        /* Pagination */
        .pagination .page-item.active .page-link {
            background: linear-gradient(135deg, var(--orange-primary), var(--orange-secondary));
            border-color: var(--orange-primary);
            color: white;
        }

        .pagination .page-link {
            color: var(--orange-secondary);
        }

        .pagination .page-link:hover {
            background-color: rgba(255, 107, 53, 0.1);
            color: var(--orange-secondary);
        }

        /* Modal header - Orange gradient */
        .modal-header-gradient {
            background: linear-gradient(135deg, var(--orange-primary), var(--orange-secondary)) !important;
            color: white !important;
        }

        .modal-header-gradient .modal-title {
            color: white !important;
        }

        /* Modal close button fix */
        .btn-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 1;
            color: #000;
            text-shadow: 0 1px 0 #fff;
            opacity: 0.5;
            cursor: pointer;
        }

        .btn-close:hover {
            opacity: 0.75;
        }

        .btn-close-white {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
    </style>
    <!-- Using Bootstrap card component -->
    <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body p-4">
            <!-- Search and Filter Bar using Bootstrap flex utilities -->
            <div class="d-flex flex-wrap gap-3 mb-4 align-items-center">
                <!-- Search Input with Bootstrap input-group -->
                <div class="flex-grow-1" style="min-width: 300px;">
                    <div class="input-group">
                            <span class="input-group-text bg-white border-end-0">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                            </span>
                        <input
                                type="text"
                                class="form-control border-start-0 ps-0"
                                id="searchInput"
                                placeholder="Search by name, email, or order ID #"
                        />
                    </div>
                </div>

                <!-- Sort Dropdown using Bootstrap select -->
                <select class="form-select" id="sortDropdown" style="width: auto; min-width: 150px;">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="amount-high">Highest Price</option>
                    <option value="amount-low">Lowest Price</option>
                </select>

                <!-- Status Filter Dropdown -->
                <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle d-flex align-items-center gap-2" type="button" id="statusFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"></polygon>
                    </svg>
                        <span id="statusFilterText">All Status</span>
                </button>
                    <ul class="dropdown-menu" aria-labelledby="statusFilterDropdown">
                        <li><a class="dropdown-item status-filter-option" href="#" data-status="" onclick="selectStatusFilter(this)">All</a></li>
                        <li><a class="dropdown-item status-filter-option" href="#" data-status="PENDING" onclick="selectStatusFilter(this)">Pending</a></li>
                        <li><a class="dropdown-item status-filter-option" href="#" data-status="PAID" onclick="selectStatusFilter(this)">Paid</a></li>
                        <li><a class="dropdown-item status-filter-option" href="#" data-status="CANCELLED" onclick="selectStatusFilter(this)">Cancelled</a></li>
                        <li><a class="dropdown-item status-filter-option" href="#" data-status="EXPIRED" onclick="selectStatusFilter(this)">Expired</a></li>
                        <li><a class="dropdown-item status-filter-option" href="#" data-status="REFUNDED" onclick="selectStatusFilter(this)">Refunded</a></li>
                    </ul>
                </div>

                <!-- Export Button with custom gradient -->
                <button class="btn text-white d-flex align-items-center gap-2 btn-export" 
                        id="exportBtn"
                        style="background: linear-gradient(135deg, var(--green-primary), var(--green-secondary)); border: none; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Export
                </button>
            </div>

            <!-- Orders Table using Bootstrap table classes -->
            <div th:if="${orders.hasContent()}">
                <div class="table-responsive">
                    <table class="table table-hover orders-table mb-4">
                        <thead>
                        <tr>
                            <th class="py-3">Order ID</th>
                            <th class="py-3">Event</th>
                            <th class="py-3">Ticket Type</th>
                            <th class="py-3">Participant</th>
                            <th class="py-3">Status</th>
                            <th class="py-3">Total Amount</th>
                            <th class="py-3">Created Date</th>
                            <th class="py-3">Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="order : ${orders.content}">
                            <td>
                                <span class="fw-semibold text-secondary">#<span th:text="${order.orderId}"></span></span>
                            </td>
                            <td>
                                <div class="d-flex align-items-center gap-3">
                                    <img
                                            th:src="${order.eventImageUrl != null ? order.eventImageUrl : '/images/Logo.png'}"
                                            alt="Event"
                                            class="rounded"
                                            style="width: 50px; height: 50px; object-fit: cover;"
                                    />
                                    <span class="fw-medium text-truncate" style="max-width: 200px;" th:text="${order.eventTitle}"></span>
                                </div>
                            </td>
                            <td th:text="${order.ticketTypeName}"></td>
                            <td th:text="${order.participantName}"></td>
                            <td>
                                        <span
                                                class="status-badge"
                                                th:classappend="${'status-' + #strings.toLowerCase(order.status)}"
                                                th:text="${order.status}"
                                        ></span>
                            </td>
                            <td>
                                <span class="fw-bold fs-6" style="color: var(--orange-primary);" th:text="${order.formattedAmount}"></span>
                            </td>
                            <td th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}"></td>
                            <td>
                                <button
                                        class="btn btn-sm btn-outline-primary"
                                        style="border-color: var(--green-primary); color: var(--green-primary); background: transparent;"
                                        th:attr="data-order-id=${order.orderId}"
                                        onclick="viewOrderDetail(this)"
                                        onmouseover="this.style.background='var(--green-primary)'; this.style.color='white';"
                                        onmouseout="this.style.background='transparent'; this.style.color='var(--green-primary)';"
                                >
                                    View Details
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination using Bootstrap pagination -->
                <div class="d-flex justify-content-between align-items-center pt-4 border-top">
                    <div class="text-muted small">
                        Showing <span th:text="${orders.numberOfElements}"></span> of <span th:text="${orders.totalElements}"></span> orders
                    </div>
                    <nav>
                        <ul class="pagination mb-0">
                            <li class="page-item" th:classappend="${orders.first} ? 'disabled'">
                                <a class="page-link" 
                                   th:onclick="${!orders.first} ? |loadOrdersPage(${orders.number - 1})| : ''"
                                   th:if="${!orders.first}"
                                   href="javascript:void(0)">
                                    Previous
                                </a>
                                <span class="page-link" th:if="${orders.first}">Previous</span>
                            </li>

                            <li
                                    class="page-item"
                                    th:each="i : ${#numbers.sequence(0, orders.totalPages - 1)}"
                                    th:classappend="${i == orders.number} ? 'active'"
                            >
                                <a class="page-link" 
                                   th:onclick="|loadOrdersPage(${i})|"
                                   th:text="${i + 1}"
                                   href="javascript:void(0)"></a>
                            </li>

                            <li class="page-item" th:classappend="${orders.last} ? 'disabled'">
                                <a class="page-link"
                                   th:onclick="${!orders.last} ? |loadOrdersPage(${orders.number + 1})| : ''"
                                   th:if="${!orders.last}"
                                   href="javascript:void(0)">
                                    Next
                                </a>
                                <span class="page-link" th:if="${orders.last}">Next</span>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- Empty State using Bootstrap utilities -->
            <div th:unless="${orders.hasContent()}" class="text-center py-5">
                <svg class="mx-auto mb-4 opacity-50" width="120" height="120" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="40" y="60" width="120" height="100" rx="8" stroke="#9ca3af" stroke-width="3" fill="none"/>
                    <path d="M40 80 L160 80" stroke="#9ca3af" stroke-width="3"/>
                    <circle cx="70" cy="110" r="8" fill="#9ca3af"/>
                    <line x1="90" y1="110" x2="140" y2="110" stroke="#9ca3af" stroke-width="3"/>
                    <circle cx="70" cy="135" r="8" fill="#9ca3af"/>
                    <line x1="90" y1="135" x2="140" y2="135" stroke="#9ca3af" stroke-width="3"/>
                    <path d="M50 40 Q50 20 70 20 L130 20 Q150 20 150 40" stroke="#9ca3af" stroke-width="3" fill="none"/>
                    <circle cx="100" cy="30" r="15" fill="#e5e7eb"/>
                    <text x="100" y="38" text-anchor="middle" font-size="20" fill="#6b7280">$</text>
                </svg>
                <h3 class="h5 fw-semibold text-secondary mb-2">No orders to display</h3>
                <p class="text-muted small">Your orders will appear here once they start participating.</p>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal using Bootstrap modal -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow">
                <div class="modal-header modal-header-gradient border-0">
                    <h5 class="modal-title fw-semibold">Order Details #<span id="detailOrderId"></span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <!-- Event Information -->
                    <div class="mb-4">
                        <h6 class="fw-semibold text-dark mb-3 pb-2 border-bottom">Event Information</h6>
                        <div class="d-flex justify-content-between py-2 border-bottom">
                            <span class="text-muted">Event Name</span>
                            <span class="fw-medium text-end" id="detailEventTitle"></span>
                        </div>
                        <div class="d-flex justify-content-between py-2 border-bottom">
                            <span class="text-muted">Ticket Type</span>
                            <span class="fw-medium" id="detailTicketType"></span>
                        </div>
                    </div>

                    <!-- Participant Information -->
                    <div class="mb-4">
                        <h6 class="fw-semibold text-dark mb-3 pb-2 border-bottom">Participant Information</h6>
                        <div class="d-flex justify-content-between py-2 border-bottom">
                            <span class="text-muted">Full Name</span>
                            <span class="fw-medium" id="detailParticipantName"></span>
                        </div>
                        <div class="d-flex justify-content-between py-2 border-bottom">
                            <span class="text-muted">Email</span>
                            <span class="fw-medium" id="detailCustomerEmail"></span>
                        </div>
                    </div>

                    <!-- Payment Information -->
                    <div class="mb-3">
                        <h6 class="fw-semibold text-dark mb-3 pb-2 border-bottom">Payment Information</h6>
                        <div class="d-flex justify-content-between py-2 border-bottom">
                            <span class="text-muted">Status</span>
                            <span id="detailStatus"></span>
                        </div>
                        <div class="d-flex justify-content-between py-2 border-bottom">
                            <span class="text-muted">Created Date</span>
                            <span class="fw-medium" id="detailCreatedAt"></span>
                        </div>
                        <div class="bg-light rounded p-3 mt-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="fw-semibold fs-6">Total Amount</span>
                                <span class="fw-bold fs-4" style="color: var(--orange-primary);" id="detailTotalAmount"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/orders.js"></script>
</div>
