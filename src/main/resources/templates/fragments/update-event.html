<!-- Event Form Fragment -->
<div th:fragment="content" xmlns:th="http://www.thymeleaf.org">
    <!-- Back Button -->
    <div class="mb-4">
        <a th:href="@{'/manage/event/' + ${request.id} + '/getting-started'}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i>
            Back to main page
        </a>
    </div>
    <form th:action="@{'/api/events/update/' + ${request.id}}"
          th:object="${request}"
          method="post"
          enctype="multipart/form-data">
          

        <div class="event-content">
            <!-- Upload Photos -->
            <div class="event-upload-section">
                <!-- Main Poster -->
                <div class="upload-card">
                    <div class="upload-header">
                        <h3><i class="fas fa-image"></i> Main Poster</h3>
                        <p>The photo will appear at the top of the event page and can be auto-scrolled.</p>
                    </div>
                    <div class="upload-area" id="posterUploadArea">
                        <button type="button" class="upload-btn" id="posterUploadBtn">
                            <i class="fas fa-plus"></i>
                            <span>Add poster</span>
                        </button>
                        <input type="file" id="posterUploadInput" accept="image/*" style="display:none" multiple>
                        <div class="upload-info">
                            <small>Supports: JPG, PNG, WebP • Maximum 5MB per image</small>
                        </div>
                    </div>
                    <div id="posterPreview" class="preview-container"></div>
                </div>

                <!-- Gallery Images -->
                <div class="upload-card">
                    <div class="upload-header">
                        <h3><i class="fas fa-images"></i> Gallery picture</h3>
                        <p>Photos will be displayed in the event gallery (maximum 5 photos)</p>
                    </div>
                    <div class="upload-area" id="galleryUploadArea">
                        <button type="button" class="upload-btn" id="galleryUploadBtn">
                            <i class="fas fa-plus"></i>
                            <span>Add picture gallery</span>
                        </button>
                        <input type="file" id="galleryUploadInput" accept="image/*" style="display:none" multiple>
                        <div class="upload-info">
                            <small>Supports: JPG, PNG, WebP • Maximum 5MB per image • Maximum 5 images</small>
                        </div>
                    </div>
                    <div id="galleryPreview" class="preview-container"></div>
                </div>
            </div>

            <!-- Type of Event -->
            <div class="event-type-title" style="font-size:1.25em;font-weight:600;margin-bottom:10px;margin-top:18px;">
                Select event type
            </div>

            <input type="hidden" th:field="*{eventType}" />

            <div class="event-type-tabs">
                <button th:if="${eventTypes == 'MusicEvent'}" class="event-type-tab active" type="button"
                        th:classappend="${request.eventType == 'MUSIC'} ? 'active' : ''"
                        onclick="selectEventType('MUSIC')">Music
                </button>
                <button th:if="${eventTypes == 'WorkshopEvent'}" class="event-type-tab active" type="button"
                        th:classappend="${request.eventType == 'WORKSHOP'} ? 'active' : ''"
                        onclick="selectEventType('WORKSHOP')">Workshop
                </button>
                <button th:if="${eventTypes == 'FestivalEvent'}" class="event-type-tab active" type="button"
                        th:classappend="${request.eventType == 'FESTIVAL'} ? 'active' : ''"
                        onclick="selectEventType('FESTIVAL')">Festival
                </button>
                <button th:if="${eventTypes == 'CompetitionEvent'}" class="event-type-tab active" type="button"
                        th:classappend="${request.eventType == 'COMPETITION'} ? 'active' : ''"
                        onclick="selectEventType('COMPETITION')">Competition
                </button>
                <button th:if="${eventTypes == 'Event'} " class="event-type-tab active" type="button"
                        th:classappend="${request.eventType == 'OTHER'} ? 'active' : ''"
                        onclick="selectEventType('OTHER')">Other
                </button>
            </div>

        <!-- Event Title -->
        <div class="event-overview-form" id="eventOverviewForm">
            <h2 class="event-form-title">Event Overview</h2>
            <div class="event-form-group">
                <label for="eventTitleInput"><b>Event name</b></label>
                <div class="event-form-desc">Be clear and descriptive with a title that tells people what your event is
                    about.
                </div>
                <input type="text" id="eventTitleInput" class="event-form-input" placeholder="Event title *"
                       maxlength="140" required th:field="*{title}">
            </div>
            <div class="event-form-group">
                <label for="eventSummaryInput"><b>Description</b></label>
                <div class="event-form-desc">
                    Grab people's attention with a short description about your event. Attendees will see this at the
                    top of your event page. (140 characters max)
                </div>
                <textarea id="eventSummaryInput" class="event-form-input" placeholder="Summary *" maxlength="140"
                          required th:field="*{description}"></textarea>
                <div class="event-form-count"><span id="summaryCount">0</span> / 140</div>
            </div>
            <div class="event-form-suggest">
                <i class="fas fa-bolt"></i> Suggest summary
            </div>
        </div>

        <!-- Date and Location -->
        <div class="event-section">
            <div class="event-date-location" style="display: flex; gap: 32px; flex-wrap: wrap;">
                <div style="flex:1; min-width:260px;">
                    <div class="event-date">
                        <label for="startsAt"><b>Start date & time</b></label>
                        <div class="event-date-picker">
                            <i class="fas fa-calendar"></i>
                            <input type="datetime-local"
                                   th:field="*{startsAt}"
                                   class="event-form-input"
                                   required>
                        </div>
                    </div>
                    <div class="event-date" style="margin-top:18px;">
                        <label for="endsAt"><b>End date & time</b></label>
                        <div class="event-date-picker">
                            <i class="fas fa-calendar"></i>
                            <input type="datetime-local"
                                   th:field="*{endsAt}"
                                   class="event-form-input"
                                   required>
                        </div>
                    </div>
                    <div class="event-date" style="margin-top:18px;">
                        <label for="enrollDeadline"><b>Enroll deadline</b></label>
                        <div class="event-date-picker">
                            <i class="fas fa-calendar-times"></i>
                            <input type="datetime-local"
                                   th:field="*{enrollDeadline}"
                                   class="event-form-input"
                                   required>
                        </div>
                        <div class="event-form-desc" style="margin-top:4px;">
                            Deadline for purchasing tickets or registering to attend the event
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="event-location"
             style="flex:2; min-width:320px; background:#fafbfc; border-radius:16px; padding:24px; margin-top:0; display:flex; flex-direction:column; align-items:flex-start;">

            <label for="locationInput" style="font-weight:600; font-size:1.1em; margin-bottom:8px;"><i
                    class="fas fa-map-marker-alt"></i> Location</label>

            <!-- Location / Place Manager -->
            <div class="event-section">
                <div class="event-section-header">
                    <h2 class="event-title"><i class="fas fa-map-marker-alt"></i> Venue</h2>
                    <p class="event-desc">Manage your list of venues for events.</p>
                </div>

                <!-- Place List Table -->
                <div style="margin-bottom:16px;">
                    <table class="table table-striped" style="width:100%; border-collapse:collapse;">
                        <thead>
                        <tr>
                            <th>Place name</th>
                            <th>Building</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody id="placeList">
                        <!-- JS will render the list temporarily -->
                        </tbody>
                    </table>
                </div>

                <!-- Add Place Button -->
                <button type="button" id="addPlaceBtn" class="btn btn-outline-primary">
                    <i class="fas fa-plus"></i> Add location
                </button>
            </div>


            <a href="#" class="event-map-toggle" style="margin-bottom:12px;">Hide map <i class="fas fa-chevron-up"></i></a>
            <div class="event-map-preview" style="width:100%;">
                <img src="/images/map.png" alt="Map" style="width:100%;border-radius:12px;">
            </div>
        </div>
</div>

<!-- Event Details -->
<div class="event-section">
    <div class="event-section-header">
        <h2 class="event-title">Event details</h2>
    </div>
    <p class="event-desc">Additional information about your event.</p>

    <!-- Building Selection -->


    <!-- Capacity & Points -->
    <div style="display: flex; gap: 16px; margin-bottom: 16px;">
        <div class="event-form-group" style="flex: 1;">
            <label for="capacityInput"><b>Capacity <span style="color:#e53935;">*</span></b></label>
            <div class="event-form-desc">Maximum number of participants</div>
            <input type="number" id="capacityInput" class="event-form-input" min="1" required th:field="*{capacity}">
        </div>
        <div class="event-form-group" style="flex: 1;">
            <label for="pointsInput"><b>Point <span style="color:#e53935;">*</span></b></label>
            <div class="event-form-desc">Bonus points for participants</div>
            <input type="number" id="pointsInput" class="event-form-input" min="0" required th:field="*{points}">
        </div>
    </div>

    <!-- Benefits -->
    <div class="event-form-group">
        <label for="benefitsInput"><b>Benefits</b></label>
        <div class="event-form-desc">Benefits that participants will receive</div>
        <textarea id="benefitsInput" class="event-form-input" placeholder="Describe the benefits of the event..." maxlength="400"
                  rows="3" th:field="*{benefits}"></textarea>
        <div class="event-form-count"><span id="benefitsCount">0</span> / 400</div>
    </div>

    <!-- Learning Objects -->
    <div class="event-form-group">
        <label for="learningObjectsInput"><b>Learning objectives</b></label>
        <div class="event-form-desc">The knowledge and skills that participants will learn</div>
        <textarea id="learningObjectsInput" class="event-form-input" placeholder="Describe the learning objectives..."
                  maxlength="400" rows="3" th:field="*{learningObjects}"></textarea>
        <div class="event-form-count"><span id="learningObjectsCount">0</span> / 400</div>
    </div>
</div>

<!-- Music Fields -->
<div id="musicFields" th:if="${eventTypes == 'MusicEvent'}" style="display:none; margin-bottom:24px;">
    <div class="event-form-group">
        <label for="musicType"><b>Music Type</b></label>
        <div class="event-form-desc">Select music type for the event</div>
        <select id="musicType" class="event-form-input" th:field="*{musicType}">
            <option value="">Select music type</option>
            <option value="LIVE">Live Music</option>
            <option value="DJ">DJ Set</option>
            <option value="ACOUSTIC">Acoustic</option>
            <option value="ELECTRONIC">Electronic</option>
            <option value="ROCK">Rock</option>
            <option value="POP">Pop</option>
            <option value="JAZZ">Jazz</option>
            <option value="CLASSICAL">Classical</option>
            <option value="OTHER">Other</option>
        </select>
    </div>
    <div class="event-form-group">
        <label for="genre"><b>Genre</b></label>
        <div class="event-form-desc">Specific music genre</div>
        <input type="text" id="genre" class="event-form-input"
               placeholder="e.g., Indie Rock, Electronic Dance Music, Jazz Fusion..." th:field="*{genre}">
    </div>
    <div class="event-form-group">
        <label for="performerCount"><b>Number of Performers</b></label>
        <div class="event-form-desc">Number of performers/artists participating</div>
        <input type="number" id="performerCount" class="event-form-input" min="1" placeholder="e.g., 3"
               th:field="*{performerCount}">
    </div>
</div>

<!-- Festival Fields -->
<div id="festivalFields" th:if="${eventTypes == 'FestivalEvent'}" style="display:none; margin-bottom:24px;">
    <div class="event-form-group">
        <label for="festivalCulture"><b>Culture</b></label>
        <input type="text" id="festivalCulture" class="event-form-input"
               placeholder="Culture (e.g. Vietnamese, Japanese)" th:field="*{culture}">
    </div>
    <div class="event-form-group">
        <label for="festivalHighlight"><b>Highlight</b></label>
        <input type="text" id="festivalHighlight" class="event-form-input" placeholder="Highlight of the festival"
               th:field="*{highlight}">
    </div>
</div>

<!-- Competition Fields -->
<div id="competitionFields" th:if="${eventTypes == 'CompetitionEvent'}" style="display:none; margin-bottom:24px;">
    <div class="event-form-group">
        <label for="competitionType"><b>Competition Type</b></label>
        <input type="text" id="competitionType" class="event-form-input"
               placeholder="Competition type (e.g. Hackathon, Esport)" th:field="*{competitionType}">
    </div>
    <div class="event-form-group">
        <label for="competitionRules"><b>Rules</b></label>
        <textarea id="competitionRules" class="event-form-input" placeholder="Competition rules"
                  th:field="*{rules}"></textarea>
    </div>
    <div class="event-form-group">
        <label for="prizePool"><b>Prize Pool</b></label>
        <input type="text" id="prizePool" class="event-form-input" placeholder="Prize pool (e.g. $1000)"
               th:field="*{prizePool}">
    </div>
</div>

<!-- Workshop Fields -->
<div id="workshopFields" th:if="${eventTypes == 'WorkshopEvent'}" style="display:none; margin-bottom:24px;">
    <div class="event-form-group">
        <label for="workshopTopic"><b>Topic</b></label>
        <input type="text" id="workshopTopic" class="event-form-input" placeholder="Workshop topic" th:field="*{topic}">
    </div>
    <div class="event-form-group">
        <label for="materialsLink"><b>Materials Link</b></label>
        <input type="url" id="materialsLink" class="event-form-input" placeholder="Link to workshop materials"
               th:field="*{materialsLink}">
    </div>
    <div class="event-form-group">
        <label for="workshopMax"><b>Maximum Participants</b></label>
        <input type="number" id="workshopMax" class="event-form-input" placeholder="Maximum participants for your event"
               th:field="*{maxParticipants}">
    </div>
    <div class="event-form-group">
        <label for="skillLevel"><b>SkillLevel</b></label>
        <input type="text" id="skillLevel" class="event-form-input" placeholder="Skill Level" th:field="*{skillLevel}">
    </div>
    <div class="event-form-group">
        <label for="prerequisites"><b>Prerequisites</b></label>
        <input type="text" id="prerequisites" class="event-form-input" placeholder="Prerequisites for your event"
               th:field="*{prerequisites}">
    </div>
</div>
<!-- Save Button -->
<div class="event-form-actions" style="margin-top: 32px; text-align: center;">
    <button type="submit" id="saveEventBtn" class="btn btn-primary btn-lg">
        <i class="fas fa-save"></i> Save Changes
    </button>
</div>
</form>
    <!-- Add Place Modal -->
    <div id="addPlaceModal"
         style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:9999;">
        <div style="background:white; padding:24px; border-radius:12px; width:400px; box-shadow:0 2px 10px rgba(0,0,0,0.2);">
            <h3 style="margin-bottom:16px;">Add New Location</h3>

            <div class="form-group" style="margin-bottom:12px;">
                <label for="newPlaceName"><b>Location Name</b></label>
                <input type="text" id="newPlaceName" class="event-form-input" placeholder="Enter location name">
            </div>

            <div class="form-group" style="margin-bottom:12px;">
                <label for="newPlaceBuilding"><b>Building</b></label>
                <select id="newPlaceBuilding" class="event-form-input">
                    <option value="NONE">NONE</option>
                    <option value="ALPHA">ALPHA</option>
                    <option value="BETA">BETA</option>
                    <option value="GAMMA">GAMMA</option>
                </select>
            </div>

            <div style="display:flex; justify-content:flex-end; gap:8px;">
                <button id="savePlaceBtn" class="btn btn-primary">Save</button>
                <button id="closePlaceModalBtn" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Additional sections -->
<div class="event-section event-additional">
    <h2>Add more sections to your event page</h2>
    <p class="event-desc">
        Make your event stand out even more. These sections help attendees find information and answer their questions -
        which means more ticket sales and less time answering messages.
    </p>
    <div class="event-add-list">
        <div class="event-add-row">
            <span class="event-add-icon"><i class="fas fa-customer"></i></span>
            <span class="event-add-label">Lineup <span class="event-add-new">New</span></span>
            <button type="button" class="event-add-btn" id="addLineupBtn">Add</button>
        </div>
        <div id="lineupSections"></div>
        <div class="event-add-row">
            <span class="event-add-icon"><i class="fas fa-calendar-alt"></i></span>
            <span class="event-add-label">Schedule</span>
            <button type="button" class="event-add-btn" id="addAgendaBtn">Add</button>
            <div id="agendaSections"></div>
        </div>
    </div>
</div>


<!-- Hidden form để submit ảnh -->
<form id="imageUploadForm" style="display: none;">
    <input type="hidden" name="eventId" id="eventIdInput">
    <input type="hidden" name="images" id="imagesInput">
</form>

<script th:inline="javascript">
    /*<![CDATA[*/
    // Pass ticket types data from Thymeleaf to JavaScript
    const initialTicketTypesData = /*[[${allTicketTypes}]]*/ [];
    console.log('Ticket types data from Thymeleaf (settings):', initialTicketTypesData);
    
    // Pass images data from Thymeleaf to JavaScript (for loading existing images)
    const initialImagesData = /*[[${imagesData}]]*/ [];
    console.log('Images data from Thymeleaf (update-event fragment):', initialImagesData);
    
    // Make it global so image-manager.js can access it
    if (typeof window !== 'undefined') {
        window.initialImagesData = initialImagesData;
    }
    
    // Pass eventType from Thymeleaf to JavaScript to auto-show fields on page load
    const currentEventType = /*[[${request.eventType}]]*/ null;
    console.log('Current event type from Thymeleaf:', currentEventType);
    
    // Auto-show fields based on current event type when page loads
    if (currentEventType) {
        // Wait for DOM to be ready and then show the appropriate fields
        function autoShowEventTypeFields() {
            console.log('Auto-showing fields for event type:', currentEventType);
            
            // Hide all fields first
            const fields = ['musicFields', 'festivalFields', 'competitionFields', 'workshopFields'];
            fields.forEach(fieldId => {
                const el = document.getElementById(fieldId);
                if (el) {
                    el.style.display = 'none';
                }
            });
            
            // Show the relevant field based on event type
            let fieldToShow = null;
            switch(currentEventType) {
                case 'MUSIC':
                    fieldToShow = 'musicFields';
                    break;
                case 'FESTIVAL':
                    fieldToShow = 'festivalFields';
                    break;
                case 'COMPETITION':
                    fieldToShow = 'competitionFields';
                    break;
                case 'WORKSHOP':
                    fieldToShow = 'workshopFields';
                    break;
                case 'OTHER':
                    // No specific fields for OTHER
                    break;
            }
            
            if (fieldToShow) {
                const fieldEl = document.getElementById(fieldToShow);
                if (fieldEl) {
                    fieldEl.style.display = 'block';
                    console.log('Showing field:', fieldToShow);
                } else {
                    console.warn('Field element not found:', fieldToShow);
                }
            }
        }
        
        // Run when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', autoShowEventTypeFields);
        } else {
            // DOM already loaded, wait a bit for SPA to inject content
            setTimeout(autoShowEventTypeFields, 100);
        }
        
        // Also expose for SPA router to call
        window.autoShowEventTypeFields = autoShowEventTypeFields;
    }
    /*]]>*/
</script>

</div>




