    <!DOCTYPE html>
    <html lang="en"
          xmlns:th="http://www.thymeleaf.org"
    >
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Open.Event</title>
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

        <!-- Bootstrap Icons -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

        <link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet">
        <!-- Cropper.js -->

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
        <link rel="stylesheet" href="/css/getting-stared.css">
        <link rel="stylesheet" href="/css/create-event.css">
        <link rel="stylesheet" href="/css/update-ticket.css">
        <link rel="stylesheet" href="/css/orders.css">
        <link rel="stylesheet" href="/css/dashboard-event.css">
        <link rel="stylesheet" href="/css/event-attendees.css">

        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

        <!-- ApexCharts CDN -->
        <script src="https://cdn.jsdelivr.net/npm/apexcharts@latest/dist/apexcharts.min.js"></script>
    </head>
    <body>
    <div class="wrapper">
        <!-- Sidebar Fragment -->
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <div class="logo-icon">
                        <img src="/img/logo1.png" alt="Open.Event Logo">
                    </div>
                    <span class="logo-text">Open.Event</span>
                </div>
                <button class="btn-toggle-sidebar d-lg-none" id="sidebarToggleMobile">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>

            <div class="sidebar-status">
                <div class="status-badge">
                    <i class="bi bi-broadcast"></i>
                    <span>Trực tiếp</span>
                    <small>Nhập để gỡ bỏ</small>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">TỔNG QUAN</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/getting-started'}" class="nav-link" data-link>
                                <i class="bi bi-star"></i>
                                <span>Bắt đầu</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/dashboard-event'}" class="nav-link" data-link>
                                <i class="bi bi-grid"></i>
                                <span>Bảng điều khiển</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/reports'}" class="nav-link" data-link>
                                <i class="bi bi-clock-history"></i>
                                <span>Báo cáo</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">QUẢN LÝ</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/settings'}" class="nav-link" data-link>
                                <i class="bi bi-gear"></i>
                                <span>Cài đặt</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/attendees'}" class="nav-link" data-link>
                                <i class="bi bi-people"></i>
                                <span>Người tham dự</span>
                                <span class="badge">0</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/volunteers'}" class="nav-link" data-link>
                                <i class="bi bi-people-fill"></i>
                                <span>Tình nguyện viên</span>
                            </a>
                        </li>
                       
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/orders'}" class="nav-link" data-link>
                                <i class="bi bi-receipt"></i>
                                <span>Đơn hàng</span>
                                <span class="badge">0</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/ticket'}" class="nav-link" data-link>
                                <i class="bi bi-ticket-perforated"></i>
                                <span>Vé</span>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/request-form'}" class="nav-link" data-link>
                                <i class="fas fa-paper-plane"></i>
                                <span>Yêu cầu duyệt</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/manage/event/check-in" class="nav-link" data-link>
                                <i class="bi bi-list-check"></i>
                                <span>Danh sách Check-In</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                <i class="bi bi-tag"></i>
                                <span>Mã khuyến mãi</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">QUẢN LÝ FORM</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/statis-forms'}" class="nav-link" data-link>
                                <i class="bi bi-bar-chart"></i>
                                <span>Thống kê Form</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/create-forms'}" class="nav-link" data-link>
                                <i class="bi bi-file-earmark-plus"></i>
                                <span>Tạo Form</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/qr-codes'}" class="nav-link" data-link>
                                <i class="bi bi-qr-code"></i>
                                <span>QR Codes</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">THÔNG BÁO</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a th:href="@{'/manage/event/' + ${eventId} + '/notification'}" class="nav-link" data-link>
                                <i class="bi bi-bell"></i>
                                <span>Thông báo</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">CÔNG CỤ</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="/manage/events/homepage-designer" class="nav-link">
                                <i class="bi bi-palette"></i>
                                <span>Thiết kế trang sự kiện</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <button class="btn-collapse-sidebar d-none d-lg-flex" id="sidebarCollapse" title="Thu gọn/Mở rộng sidebar">
                <i class="bi bi-chevron-left"></i>
            </button>
        </aside>

        <div id="main-wrapper">
            <header class="main-header">
                <div class="header-left">
                    <button class="btn-toggle-sidebar" id="sidebarToggle">
                        <i class="bi bi-list"></i>
                    </button>

                    <nav class="breadcrumb-nav">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">
                                <a href="#"><i class="bi bi-house-door"></i> Trang chủ</a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="#">duc le</a>
                            </li>
                            <li class="breadcrumb-item active">edqd</li>
                        </ol>
                    </nav>
                </div>
                <a th:href="@{/}" class="btn btn-homepage">
                    <i class="fas fa-home"></i>
                    Về trang chủ
                </a>
                <div class="header-right">
                    <a th:href="@{/organizer}" class="btn btn-outline-light btn-sm">
                        <i class="bi bi-box-arrow-up-right"></i>
                        Quay lại trang Host
                    </a>


                    <div class="dropdown">
                        <button class="btn btn-icon" data-bs-toggle="dropdown" id="userDropdownBtn">
                            <i class="bi bi-person-circle"></i>
                            <span class="d-none d-md-inline" id="userDisplayName">DL</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><h6 class="dropdown-header" id="userNameHeader">User</h6></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#">Tiếng Việt</a></li>
                            <li><a class="dropdown-item" href="#">English</a></li>
                        </ul>
                    </div>
                </div>
            </header>

            <!-- Main Content Fragment -->
            <main id="main-content" class="main-content">
                <div th:replace="~{__${content}__}"></div>
                <!-- Content will be loaded dynamically by SPA router -->
            </main>


        </div>
    </div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Cropper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        // Thymeleaf sẽ tự động chuyển đổi List<Speaker> thành một mảng đối tượng JavaScript
        const initialSpeakersData = /*[[${speakersData}]]*/ [];
        const initialSchedulesData = /*[[${schedulesData}]]*/ [];
        const initialImagesData = /*[[${imagesData}]]*/ [];
        const initialPlacesData = /*[[${allPlaces}]]*/ [];
        const initialTicketTypesData = /*[[${allTicketTypes}]]*/ [];

        console.log('Dữ liệu speakers từ Thymeleaf:', initialSpeakersData);
        console.log('Dữ liệu schedules từ Thymeleaf:', initialSchedulesData);
        console.log('Dữ liệu images từ Thymeleaf:', initialImagesData);
        console.log('Dữ liệu places từ Thymeleaf:', initialPlacesData);
        console.log('Dữ liệu ticket types từ Thymeleaf:', initialTicketTypesData);
        /*]]>*/
    </script>
    <script src="/js/orders.js"></script>
    <script src="/js/dashboard-event.js"></script>
    <script src="/js/getting-started.js"></script>
    <script src="/js/event-form.js"></script>
    <script src="/js/lineup-manager.js?v=15"></script>
    <script src="/js/agenda-manager.js?v=7"></script>
    <script src="/js/image-manager.js?v=1"></script>
    <script src="/js/place-manager.js"></script>
    <script src="/js/request-form.js"></script>
    <script src="/js/sidebar-manager.js"></script>
    <script src="/js/update-event.js"></script>
    <script src="/js/router.js"></script>
    <script src="/js/app.js"></script>
    <script src="/js/update-ticket.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
    <script src="/js/event-attendees.js"></script>

    <script>
        // Load and display user name and avatar in header
        function loadUserName() {
            fetch('/api/current-user')
                .then(response => response.json())
                .then(data => {
                    if (data && data.authenticated && data.name) {
                        const userDisplayNameEl = document.getElementById('userDisplayName');
                        const userNameHeaderEl = document.getElementById('userNameHeader');
                        const userDropdownBtn = document.getElementById('userDropdownBtn');
                        const userIcon = userDropdownBtn ? userDropdownBtn.querySelector('i') : null;

                        if (userDisplayNameEl) {
                            // Display name, limit to 15 characters for display
                            const displayName = data.name.length > 15 ? data.name.substring(0, 15) + '...' : data.name;
                            userDisplayNameEl.textContent = displayName;
                        }

                        if (userNameHeaderEl) {
                            userNameHeaderEl.textContent = data.name;
                        }
                        
                        // Update avatar: if avatar URL exists, replace icon with image; otherwise show initial letter
                        if (userDropdownBtn && data.avatar && data.avatar.trim() !== '') {
                            // Remove icon and add avatar image
                            if (userIcon) {
                                userIcon.style.display = 'none';
                            }
                            // Create or update avatar image
                            let avatarImg = userDropdownBtn.querySelector('img.avatar-img');
                            if (!avatarImg) {
                                avatarImg = document.createElement('img');
                                avatarImg.className = 'avatar-img';
                                avatarImg.style.width = '32px';
                                avatarImg.style.height = '32px';
                                avatarImg.style.borderRadius = '50%';
                                avatarImg.style.objectFit = 'cover';
                                userDropdownBtn.insertBefore(avatarImg, userIcon);
                            }
                            avatarImg.src = data.avatar;
                            avatarImg.alt = data.name;
                        } else if (userDisplayNameEl) {
                            // Show initial letter if no avatar
                            if (!userDisplayNameEl.textContent || userDisplayNameEl.textContent.length === 0) {
                                const initial = data.name.charAt(0).toUpperCase();
                                userDisplayNameEl.textContent = initial;
                            }
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading user name:', error);
                });
        }

        // Load user name when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadUserName);
        } else {
            loadUserName();
        }
    </script>

    <!-- Event Attendees Modals (Global - outside fragment to prevent recreation on reload) -->
    <!-- Add Attendee Modal -->
    <div class="modal fade" id="addModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-header bg-success text-white border-0">
                    <h5 class="modal-title fw-bold">
                        <i class="bi bi-person-plus me-2"></i>Thêm Người Tham Dự
                    </h5>
                    <button type="button" class="btn-close btn-close-white" onclick="closeAddModal()"></button>
                </div>

                <div class="modal-body p-4">
                    <form id="addForm" onsubmit="event.preventDefault(); return false;">
                        <div class="mb-3">
                            <label for="addName" class="form-label fw-bold">Tên <span class="text-danger">*</span></label>
                            <input type="text" id="addName" class="form-control form-control-lg" placeholder="Nhập tên" required>
                        </div>

                        <div class="mb-3">
                            <label for="addEmail" class="form-label fw-bold">Email <span class="text-danger">*</span></label>
                            <input type="email" id="addEmail" class="form-control form-control-lg" placeholder="example@email.com" required>
                        </div>

                        <div class="mb-3">
                            <label for="addPhone" class="form-label fw-bold">Số Điện Thoại <span class="text-danger">*</span></label>
                            <input type="tel" id="addPhone" class="form-control form-control-lg" placeholder="0912345678" required>
                        </div>

                        <div class="mb-3">
                            <label for="addOrganization" class="form-label fw-bold">Tổ Chức</label>
                            <input type="text" id="addOrganization" class="form-control form-control-lg" placeholder="Nhập tổ chức (nếu có)">
                        </div>

                        <div class="mb-3">
                            <label for="addTicketType" class="form-label fw-bold">Loại Vé <span class="text-danger">*</span></label>
                            <select id="addTicketType" class="form-select form-select-lg" required>
                                <option value="">-- Chọn loại vé --</option>
                                <!-- Options will be loaded via JavaScript -->
                            </select>
                        </div>
                    </form>
                </div>

                <div class="modal-footer border-0 p-4 bg-light">
                    <button type="button" class="btn btn-secondary btn-lg fw-bold" onclick="closeAddModal()">
                        <i class="bi bi-x-lg me-1"></i>Hủy
                    </button>
                    <button type="button" class="btn btn-success btn-lg fw-bold" onclick="submitAddAttendee()">
                        <i class="bi bi-plus-lg me-1"></i>Thêm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Attendee Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-header bg-primary text-white border-0">
                    <h5 class="modal-title fw-bold">
                        <i class="bi bi-pencil-square me-2"></i>Chỉnh Sửa Người Tham Dự
                    </h5>
                    <button type="button" class="btn-close btn-close-white" onclick="closeEditModal()"></button>
                </div>

                <div class="modal-body p-4">
                    <form id="editForm" onsubmit="event.preventDefault(); return false;">
                        <input type="hidden" id="editAttendanceId">

                        <div class="mb-3">
                            <label for="editName" class="form-label fw-bold">Tên <span class="text-danger">*</span></label>
                            <input type="text" id="editName" class="form-control form-control-lg" placeholder="Nhập tên" required>
                        </div>

                        <div class="mb-3">
                            <label for="editEmail" class="form-label fw-bold">Email <span class="text-danger">*</span></label>
                            <input type="email" id="editEmail" class="form-control form-control-lg" placeholder="example@email.com" required>
                        </div>

                        <div class="mb-3">
                            <label for="editPhone" class="form-label fw-bold">Số Điện Thoại <span class="text-danger">*</span></label>
                            <input type="tel" id="editPhone" class="form-control form-control-lg" placeholder="0912345678" required>
                        </div>

                        <div class="mb-3">
                            <label for="editOrganization" class="form-label fw-bold">Tổ Chức</label>
                            <input type="text" id="editOrganization" class="form-control form-control-lg" placeholder="Nhập tổ chức (nếu có)">
                        </div>
                    </form>
                </div>

                <div class="modal-footer border-0 p-4 bg-light">
                    <button type="button" class="btn btn-secondary btn-lg fw-bold" onclick="closeEditModal()">
                        <i class="bi bi-x-lg me-1"></i>Hủy
                    </button>
                    <button type="button" class="btn btn-primary btn-lg fw-bold" onclick="submitEditAttendee()">
                        <i class="bi bi-check-lg me-1"></i>Lưu
                    </button>
                </div>
            </div>
        </div>
    </div>
    </body>

    </html>