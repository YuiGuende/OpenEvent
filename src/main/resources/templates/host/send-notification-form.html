<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>G·ª≠i Th√¥ng B√°o S·ª± Ki·ªán</title>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f4f7f6; padding: 20px; }
        .notification-container {
            max-width: 650px;
            margin: 50px auto;
            background: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 30px; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #333; }
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
            resize: vertical;
        }
        textarea { min-height: 150px; }
        .event-info { background: #e9f0ff; padding: 10px; border-radius: 6px; margin-bottom: 20px; color: #004085; }
        button {
            background-color: #28a745;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        button:hover { background-color: #218838; }
        .error-message { color: #dc3545; margin-top: 10px; font-weight: bold; }
        .success-message { color: #28a745; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="notification-container">
    <h2>üì£ G·ª≠i Th√¥ng B√°o ƒê·∫øn Ng∆∞·ªùi Tham Gia</h2>

    <div class="event-info">
        ƒêang g·ª≠i th√¥ng b√°o cho S·ª± ki·ªán: <strong th:text="${event.title}">[Event ID]</strong>
    </div>

    <form id="notificationForm">
        <input type="hidden" id="eventId" name="eventId" th:value="${eventId}">

        <label for="title">Ti√™u ƒë·ªÅ Th√¥ng b√°o (T√πy ch·ªçn):</label>
        <input type="text" id="title" name="title" maxlength="100" placeholder="V√≠ d·ª•: Thay ƒë·ªïi ƒë·ªãa ƒëi·ªÉm, C·∫ßn chu·∫©n b·ªã..." />

        <label for="message">N·ªôi dung Th√¥ng b√°o (*):</label>
        <textarea id="message" name="message" required placeholder="Nh·∫≠p n·ªôi dung th√¥ng b√°o chi ti·∫øt t·∫°i ƒë√¢y (T·ªëi ƒëa 500 k√Ω t·ª±)"></textarea>

        <button type="submit">G·ª≠i Th√¥ng B√°o Ngay</button>

        <div id="responseMessage" class="success-message" style="display: none;"></div>
        <div id="errorMessage" class="error-message" style="display: none;"></div>
    </form>
</div>

<script>
    document.getElementById('notificationForm').addEventListener('submit', function(event) {
        event.preventDefault(); // NgƒÉn form g·ª≠i theo c√°ch truy·ªÅn th·ªëng

        const eventId = document.getElementById('eventId').value;
        const title = document.getElementById('title').value;
        const message = document.getElementById('message').value;

        // X√≥a th√¥ng b√°o c≈©
        document.getElementById('responseMessage').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'none';

        if (!message) {
            document.getElementById('errorMessage').innerText = 'N·ªôi dung th√¥ng b√°o kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.';
            document.getElementById('errorMessage').style.display = 'block';
            return;
        }

        const notificationData = {
            eventId: eventId,
            title: title,
            message: message,
            // Th√™m type n·∫øu c·∫ßn, v√≠ d·ª•: type: "CUSTOMER_NOTIFICATION"
        };

        // ƒê·ªãa ch·ªâ API ƒë√∫ng
        const apiUrl = '/api/notifications/event-participants';

        fetch(apiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // Th√™m header authorization n·∫øu b·∫°n d√πng Spring Security
                // 'Authorization': 'Bearer ' + yourToken,
            },
            body: JSON.stringify(notificationData)
        })
            .then(response => {
                // Ki·ªÉm tra HTTP status code
                if (response.ok) {
                    return response.text(); // ƒê·ªçc body d∆∞·ªõi d·∫°ng text
                } else {
                    // X·ª≠ l√Ω l·ªói t·ª´ server (4xx ho·∫∑c 5xx)
                    return response.text().then(text => { throw new Error(text || `L·ªói: ${response.status} ${response.statusText}`); });
                }
            })
            .then(data => {
                // X·ª≠ l√Ω th√†nh c√¥ng
                document.getElementById('responseMessage').innerText = '‚úÖ ' + data;
                document.getElementById('responseMessage').style.display = 'block';
                // X√≥a n·ªôi dung form sau khi g·ª≠i th√†nh c√¥ng
                document.getElementById('title').value = '';
                document.getElementById('message').value = '';
            })
            .catch(error => {
                // X·ª≠ l√Ω l·ªói m·∫°ng ho·∫∑c l·ªói custom t·ª´ .then(response)
                console.error('L·ªói khi g·ª≠i th√¥ng b√°o:', error);
                document.getElementById('errorMessage').innerText = '‚ùå G·ª≠i th·∫•t b·∫°i: ' + error.message;
                document.getElementById('errorMessage').style.display = 'block';
            });
    });
</script>

</body>
</html>