<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head th:replace="~{fragments/head :: head(${pageTitle})}"></head>

<body class="page-bg"
      th:with="
        pageTitle='Trang chủ',
        activeMenu='home',
        uid=${#authorization.expression('isAuthenticated()')} ? #authentication?.name : null
      "
      th:attr="data-user-id=${uid}"
      th:replace="~{layout :: layout(~{::main}, ${activeMenu}, ${uid})}">

<!-- CHỈ GIỮ NỘI DUNG MAIN -->
<main>
    <section class="hero hero--slider">
        <div class="hero-track" id="heroTrack">
            <div class="hero-slide"
                 th:each="event : ${posterEvents}"
                 th:style="|background-image: url('${event.imageUrl}')|">
            </div>
            <div class="hero-slide" th:if="${#lists.isEmpty(posterEvents)}"
                 th:style="|background-image: url('@{/img/banner1.jpg}')|"></div>
        </div>

        <button class="hero-nav prev" id="heroPrev" aria-label="Previous">‹</button>
        <button class="hero-nav next" id="heroNext" aria-label="Next">›</button>
        <div class="hero-progress">
            <div class="hero-progress-bar" th:each="event : ${posterEvents}"></div>
            <div class="hero-progress-bar" th:if="${#lists.isEmpty(posterEvents)}"></div>
        </div>
    </section>

    <div class="search-center-position">
        <div class="container">
            <div th:replace="~{fragments/searchbar :: searchBar}"></div>
            <div class="chip-row" style="margin-bottom: .5rem;">
                <a class="chip is-active" th:href="@{/events(reco='for-you')}">For you</a>
                <a class="chip" th:href="@{/events(reco='near-you')}">Near you</a>
                <a class="chip" th:href="@{/events(reco='trending')}">Trending</a>
                <a class="chip" th:href="@{/events(freeOnly=true)}">Free</a>
            </div>
        </div>
    </div>

    <!-- Your Events -->
    <section class="section">
        <div class="container">
            <div class="your-events-header">
                <h2 class="section-title">Your Events</h2>
                <div style="background:#f0f0f0;padding:1rem;margin:1rem 0;border-radius:8px;font-size:.9rem;display:none;">
                    <strong>Debug Info:</strong>
                    MyEvents count: <span th:text="${#lists.size(myEvents)}">0</span>
                    <div th:if="${!#lists.isEmpty(myEvents)}">
                        First: <span th:text="${myEvents[0].title}">N/A</span> – <span th:text="${myEvents[0].city}">N/A</span>
                    </div>
                    <div th:if="${#lists.isEmpty(myEvents)}"><span style="color:red;">No events found</span></div>
                </div>
            </div>

            <div class="grid grid-3" th:if="${!#lists.isEmpty(myEvents)}">
                <article class="event-card-simple" th:each="ev : ${myEvents}">
                    <a th:href="@{/{eventType}/{id}(eventType=${ev.eventType.name().toLowerCase()}, id=${ev.id})}"
                       style="text-decoration:none;color:inherit;">
                        <img class="event-cover" th:src="${ev.imageUrl}" th:alt="${ev.title}"/>
                        <div class="card-body">
                            <h3 class="card-title" th:text="${ev.title}">Event title</h3>
                            <p class="card-meta" th:text="${ev.city + ' • ' + ev.dateLabel + ' • ' + ev.durationLabel}">Meta</p>
                            <p class="event-org" th:text="${'Organizer: ' + ev.organizer}">Organizer</p>
                            <div class="capacity">
                                <div class="capacity-row">
                                    <span th:text="${'Registered: ' + ev.registered + ' / ' + ev.capacity}"></span>
                                    <span class="capacity-mini" th:text="${'Price: ' + ev.priceLabel}"></span>
                                </div>
                                <div class="bar"><div class="fill" th:style="|width: ${ev.registrationPercentage}%|"></div></div>
                            </div>
                            <div class="event-tags">
                                <span class="tag" th:text="${'#' + ev.eventTypeTag}">#Tag</span>
                                <span class="badge badge-live" th:if="${ev.live}">Live</span>
                                <span class="tag" th:if="${ev.soldOut}">Sold Out</span>
                            </div>
                        </div>
                    </a>
                </article>
            </div>

            <div class="empty-events-simple" th:if="${#lists.isEmpty(myEvents)}">
                <p>You haven't registered for any events yet. <a href="/events">Explore events</a> to get started!</p>
            </div>

            <div class="pager">
                <button class="icon-btn" aria-label="Prev">‹</button>
                <span>1 / 5</span>
                <button class="icon-btn" aria-label="Next">›</button>
            </div>
        </div>
    </section>

    <!-- Latest Events -->
    <section class="section">
        <div class="container">
            <div class="latest-events-header">
                <h2 class="section-title">Latest Events</h2>
                <div class="pagination-controls" th:if="${!#lists.isEmpty(latestEvents)}">
                    <button class="pagination-btn prev-btn" id="prevLatestBtn" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24"><path d="M15.09 4.08L8.57 10.6c-.77.77-.77 2.03 0 2.8l6.52 6.52" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <span>Previous</span>
                    </button>
                    <span class="pagination-info" id="latestPaginationInfo">1 of 1</span>
                    <button class="pagination-btn next-btn" id="nextLatestBtn">
                        <span>Next</span>
                        <svg width="16" height="16" viewBox="0 0 24 24"><path d="M8.91 19.92l6.52-6.52c.77-.77.77-2.03 0-2.8L8.91 4.08" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                </div>
            </div>

            <div class="grid grid-3" th:if="${!#lists.isEmpty(latestEvents)}">
                <article class="event-card-simple" th:each="ev : ${latestEvents}">
                    <a th:href="@{/{eventType}/{id}(eventType=${ev.eventType.name().toLowerCase()}, id=${ev.id})}"
                       style="text-decoration:none;color:inherit;">
                        <img class="event-cover" th:src="${ev.imageUrl}" th:alt="${ev.title}"/>
                        <div class="card-body">
                            <h3 class="card-title" th:text="${ev.title}">Event title</h3>
                            <p class="card-meta" th:text="${ev.city + ' • ' + ev.dateLabel + ' • ' + ev.durationLabel}">Meta</p>
                            <p class="event-org" th:text="${'Organizer: ' + ev.organizer}">Organizer</p>
                            <div class="capacity">
                                <div class="capacity-row">
                                    <span th:text="${'Registered: ' + ev.registered + ' / ' + ev.capacity}"></span>
                                    <span class="capacity-mini" th:text="${'Price: ' + ev.priceLabel}"></span>
                                </div>
                                <div class="bar"><div class="fill" th:style="|width: ${ev.registrationPercentage}%|"></div></div>
                            </div>
                            <div class="event-tags">
                                <span class="tag" th:text="${'#' + ev.eventTypeTag}">#Tag</span>
                                <span class="badge badge-live" th:if="${ev.live}">Live</span>
                                <span class="tag" th:if="${ev.soldOut}">Sold Out</span>
                            </div>
                        </div>
                    </a>
                </article>
            </div>

            <div class="empty-events-simple" th:if="${#lists.isEmpty(latestEvents)}">
                <p>No latest events available. <a href="/events">Check out all events</a>!</p>
            </div>
        </div>
    </section>

    <!-- Live Events + Recommended (giữ nguyên nội dung của bạn, lược bớt ở đây cho gọn) -->
    <!-- ... phần Live Events & Recommended ... -->

</main>
</body>
</html>
