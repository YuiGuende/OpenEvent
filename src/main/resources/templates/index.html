<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head th:replace="~{fragments/head :: head('Trang ch·ªß')}"></head>

<body class="page-bg"
      th:with="
  pageTitle='Trang ch·ªß',
  activeMenu='home',
  uid=${#authorization.expression('isAuthenticated()')} ? #authentication.principal?.id : null
"
      th:replace="~{layout :: layout(~{::main}, ${activeMenu}, ${uid})}">

<!-- CH·ªà GI·ªÆ N·ªòI DUNG MAIN -->
<main>
    <section class="hero hero--slider">
        <div class="hero-track" id="heroTrack">
            <div class="hero-slide"
                 th:each="event : ${posterEvents}"
                 th:style="|background-image: url('${event.imageUrl}')|">
            </div>

            <div class="hero-slide" th:if="${#lists.isEmpty(posterEvents)}"
                 th:style="|background-image: url('@{/img/banner1.jpg}')|">
            </div>
        </div>

        <button class="hero-nav prev" id="heroPrev" aria-label="Previous">‚Äπ</button>
        <button class="hero-nav next" id="heroNext" aria-label="Next">‚Ä∫</button>
        <div class="hero-progress">
            <div class="hero-progress-bar" th:each="event : ${posterEvents}"></div>
            <div class="hero-progress-bar" th:if="${#lists.isEmpty(posterEvents)}"></div>
        </div>
    </section>

    <!-- Search bar positioned like Booking.com -->
    <div class="search-center-position">
        <div class="container">
            <div th:replace="~{fragments/searchbar :: searchBar}"></div>
            <div class="chip-row" style="margin-bottom: 0.5rem;">
                <a class="chip is-active" th:href="@{/events(reco='for-you')}">For you</a>
                <a class="chip" th:href="@{/events(reco='near-you')}">Near you</a>
                <a class="chip" th:href="@{/events(reco='trending')}">Trending</a>
                <a class="chip" th:href="@{/events(freeOnly=true)}">Free</a>
            </div>
        </div>
    </div>

    <section class="section">
        <div class="container">
            <div class="your-events-header">
                <h2 class="section-title">Your Events</h2>
                <a class="view-more-btn"
                   th:if="${session.ACCOUNT_ID != null}"
                   th:href="@{/orders}">
                    View all
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8.91016 19.92L15.4302 13.4C16.2002 12.63 16.2002 11.37 15.4302 10.6L8.91016 4.08"
                              stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"
                              stroke-linejoin="round"/>
                    </svg>
                </a>
            </div>

            <div class="grid grid-3" th:if="${!#lists.isEmpty(myEvents)}">
                <article class="event-card-simple" th:each="ev : ${myEvents}">
                    <a th:href="@{/{eventType}/{id}(eventType=${ev.eventType.name().toLowerCase()}, id=${ev.id})}"
                       style="text-decoration: none; color: inherit;">
                        <img class="event-cover" th:src="${ev.imageUrl}" th:alt="${ev.title}"/>
                        <div class="card-body">
                            <h3 class="card-title" th:text="${ev.title}">Event title</h3>
                            <p class="card-meta" th:text="${ev.city + ' ‚Ä¢ ' + ev.dateLabel + ' ‚Ä¢ ' + ev.durationLabel}">
                                City ‚Ä¢ Date ‚Ä¢ Duration</p>
                            <p class="event-org" th:text="${'Organizer: ' + ev.organizer}">Organizer: ...</p>

                            <div class="capacity">
                                <div class="capacity-row">
                                    <span th:text="${'Registered: ' + ev.registered + ' / ' + ev.capacity}">Registered: 0 / 0</span>
                                    <span class="capacity-mini"
                                          th:text="${'Price: ' + ev.priceLabel}">Price: Free</span>
                                </div>
                                <div class="bar">
                                    <div class="fill" th:style="|width: ${ev.registrationPercentage}%|"></div>
                                </div>
                            </div>

                            <div class="event-tags">
                                <span class="tag" th:text="${'#' + ev.eventTypeTag}">#Tag</span>
                                <span class="badge badge-live" th:if="${ev.live}">Live</span>
                                <span class="tag" th:if="${ev.soldOut}">Sold Out</span>
                            </div>
                        </div>
                    </a>
                    <!-- Check-in buttons section -->
                    <div class="checkin-section" th:attr="data-event-id=${ev.id}" style="padding: 10px; border-top: 1px solid #eee; margin-top: 10px;">
                        <div class="checkin-status" th:attr="id=${'checkin-status-' + ev.id}" style="margin-bottom: 8px; font-size: 0.9em;">
                            <span class="checkin-badge" style="display: none; padding: 4px 8px; border-radius: 4px; background: #28a745; color: white;">
                                ‚úì ƒê√£ check-in
                            </span>
                        </div>
                        <div class="checkin-buttons" style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <!-- ‚úÖ Ch·ªâ hi·ªán n√∫t check-in t·ª´ khi event b·∫Øt ƒë·∫ßu ƒë·∫øn 15 ph√∫t sau ƒë√≥ -->
                            <a th:if="${ev.startsAt != null and !ev.startsAt.isAfter(#temporals.createNow()) and ev.startsAt.plusMinutes(15).isAfter(#temporals.createNow())}"
                               th:href="@{'/events/' + ${ev.id} + '/face-checkin'}"
                               class="checkin-btn-face" 
                               style="flex: 1; min-width: 120px; padding: 8px 12px; background: #007bff; color: white; text-align: center; text-decoration: none; border-radius: 4px; font-size: 0.9em; display: inline-block;">
                                üì∑ Check-in khu√¥n m·∫∑t
                            </a>
                        </div>
                        <!-- ‚úÖ Th√¥ng b√°o check-in th√†nh c√¥ng (·∫©n m·∫∑c ƒë·ªãnh) -->
                        <div class="checkin-success-message" th:attr="id=${'checkin-success-' + ev.id}" style="display: none; padding: 8px 12px; background: #28a745; color: white; text-align: center; border-radius: 4px; font-size: 0.9em; margin-top: 8px;">
                            ‚úÖ Check-in th√†nh c√¥ng!
                        </div>
                    </div>
                </article>
            </div>

            <!-- Empty state for new users -->
            <div class="empty-events-simple" th:if="${#lists.isEmpty(myEvents)}">
                <p>You haven't registered for any events yet. <a href="/events">Explore events</a> to get started!</p>
            </div>

            <!--            <div class="grid grid-3" th:if="${#lists.isEmpty(myEvents)}">-->
            <!--                <article class="event-card">-->
            <!--                    <img src="/img/event1.jpg" alt="UI/UX Bootcamp" class="event-cover"/>-->
            <!--                    <div class="card-body">-->
            <!--                        <h3 class="card-title">UI/UX Bootcamp</h3>-->
            <!--                        <p class="card-meta">H√† N·ªôi ‚Ä¢ 20/09/2025 ‚Ä¢ 3h</p>-->
            <!--                        <p class="event-org">Organizer: Design Lab</p>-->
            <!--                        <div class="capacity">-->
            <!--                            <div class="capacity-row">-->
            <!--                                <span>Registered: 90 / 150</span>-->
            <!--                                <span class="capacity-mini">Price: Free</span>-->
            <!--                            </div>-->
            <!--                            <div class="bar">-->
            <!--                                <div class="fill" style="width:60%"></div>-->
            <!--                            </div>-->
            <!--                        </div>-->
            <!--                        <div class="event-tags">-->
            <!--                            <span class="tag">#Workshop</span>-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </article>-->

            <!--                <article class="event-card">-->
            <!--                    <img src="/img/event2.jpg" alt="Summer Fest" class="event-cover"/>-->
            <!--                    <div class="card-body">-->
            <!--                        <h3 class="card-title">Summer Fest</h3>-->
            <!--                        <p class="card-meta">HCM ‚Ä¢ 22/09/2025 ‚Ä¢ 2h</p>-->
            <!--                        <p class="event-org">Organizer: Event Hub</p>-->
            <!--                        <div class="capacity">-->
            <!--                            <div class="capacity-row">-->
            <!--                                <span>Registered: 480 / 600</span>-->
            <!--                                <span class="capacity-mini">Price: 100k</span>-->
            <!--                            </div>-->
            <!--                            <div class="bar">-->
            <!--                                <div class="fill" style="width:80%"></div>-->
            <!--                            </div>-->
            <!--                        </div>-->
            <!--                        <div class="event-tags">-->
            <!--                            <span class="tag">#Festival</span>-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </article>-->

            <!--                <article class="event-card">-->
            <!--                    <img src="/img/event3.jpg" alt="Open Campus Tour" class="event-cover"/>-->
            <!--                    <div class="card-body">-->
            <!--                        <h3 class="card-title">Open Campus Tour</h3>-->
            <!--                        <p class="card-meta">ƒê√† N·∫µng ‚Ä¢ 17/09/2025 ‚Ä¢ 1.5h</p>-->
            <!--                        <p class="event-org">Organizer: FPT University</p>-->
            <!--                        <div class="capacity">-->
            <!--                            <div class="capacity-row">-->
            <!--                                <span>Registered: 150 / 150</span>-->
            <!--                                <span class="capacity-mini">Price: Free</span>-->
            <!--                            </div>-->
            <!--                            <div class="bar">-->
            <!--                                <div class="fill" style="width:100%"></div>-->
            <!--                            </div>-->
            <!--                        </div>-->
            <!--                        <div class="event-tags">-->
            <!--                            <span class="tag">#Conference</span>-->
            <!--                            <span class="tag">Sold Out</span>-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </article>-->
            <!--            </div>-->

            <div class="pager">
                <button class="icon-btn" aria-label="Prev">‚Äπ</button>
                <span>1 / 5</span>
                <button class="icon-btn" aria-label="Next">‚Ä∫</button>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="latest-events-header">
                <h2 class="section-title">Latest Events</h2>

                <div class="chip-group">
                    <button class="chip is-active" data-filter="all">All</button>
                    <button class="chip" data-filter="Music">Music</button>
                    <button class="chip" data-filter="Workshop">Workshop</button>
                    <button class="chip" data-filter="Festival">Festival</button>
                    <button class="chip" data-filter="Competition">Competition</button>
                    <button class="chip" data-filter="Other">Other</button>
                </div>

                <div class="pagination-controls" th:if="${!#lists.isEmpty(latestEvents)}">
                    <button class="pagination-btn prev-btn" id="prevLatestBtn" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15.0898 4.08L8.56984 10.6C7.79984 11.37 7.79984 12.63 8.56984 13.4L15.0898 19.92"
                                  stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"
                                  stroke-linejoin="round"/>
                        </svg>
                        <span>Previous</span>
                    </button>
                    <span class="pagination-info" id="latestPaginationInfo">1 of 1</span>
                    <button class="pagination-btn next-btn" id="nextLatestBtn">
                        <span>Next</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8.91016 19.92L15.4302 13.4C16.2002 12.63 16.2002 11.37 15.4302 10.6L8.91016 4.08"
                                  stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"
                                  stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="latest-events-track" th:if="${!#lists.isEmpty(latestEvents)}">
                <div class="latest-events-container">
                    <article class="event-card-simple" th:each="ev : ${latestEvents}" th:attr="data-tags=${ev.eventTypeTag}">
                        <a th:href="@{/{eventType}/{id}(eventType=${ev.eventType.name().toLowerCase()}, id=${ev.id})}"
                           style="text-decoration: none; color: inherit;">
                            <img class="event-cover" th:src="${ev.imageUrl}" th:alt="${ev.title}"/>
                            <div class="card-body">
                                <h3 class="card-title" th:text="${ev.title}">Event title</h3>
                                <p class="card-meta" th:text="${ev.city + ' ‚Ä¢ ' + ev.dateLabel + ' ‚Ä¢ ' + ev.durationLabel}">
                                    City ‚Ä¢ Date ‚Ä¢ Duration</p>
                                <p class="event-org" th:text="${'Organizer: ' + ev.organizer}">Organizer: ...</p>

                                <div class="capacity">
                                    <div class="capacity-row">
                                        <span th:text="${'Registered: ' + ev.registered + ' / ' + ev.capacity}">Registered: 0 / 0</span>
                                        <span class="capacity-mini"
                                              th:text="${'Price: ' + ev.priceLabel}">Price: Free</span>
                                    </div>
                                </div>
                            </div>

                            <div class="event-tags">
                                <span class="tag" th:text="${'#' + ev.eventTypeTag}">#Tag</span>
                                <span class="badge badge-live" th:if="${ev.live}">Live</span>
                                <span class="tag" th:if="${ev.soldOut}">Sold Out</span>
                            </div>
                        </a>
                    </article>
                </div>
            </div>

            <!-- Empty state for latest events -->
            <div class="empty-events-simple" th:if="${#lists.isEmpty(latestEvents)}">
                <p>No latest events available. <a href="/events">Check out all events</a>!</p>
            </div>
        </div>
    </section>

    <section class="section live">
        <div class="container">
            <div class="live-events-header">
                <h2 class="section-title">Live Events</h2>
                <div class="chip-group">
                    <button class="chip is-active" data-filter="all">All</button>
                    <button class="chip" data-filter="Music">Music</button>
                    <button class="chip" data-filter="Workshop">Workshop</button>
                    <button class="chip" data-filter="Conference">Conference</button>
                    <button class="chip" data-filter="Festival">Festival</button>
                    <button class="chip" data-filter="Competition">Competition</button>
                    <button class="chip" data-filter="Other">Other</button>
                </div>
                <div class="pagination-controls" th:if="${!#lists.isEmpty(liveEvents)}">
                    <button class="pagination-btn prev-btn" id="prevLiveBtn" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15.0898 4.08L8.56984 10.6C7.79984 11.37 7.79984 12.63 8.56984 13.4L15.0898 19.92"
                                  stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"
                                  stroke-linejoin="round"/>
                        </svg>
                        <span>Previous</span>
                    </button>
                    <span class="pagination-info" id="livePaginationInfo">1 of 1</span>
                    <button class="pagination-btn next-btn" id="nextLiveBtn">
                        <span>Next</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8.91016 19.92L15.4302 13.4C16.2002 12.63 16.2002 11.37 15.4302 10.6L8.91016 4.08"
                                  stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"
                                  stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="live-events-track" th:if="${!#lists.isEmpty(liveEvents)}">
                <div class="live-events-container">
                    <article class="event-card-simple" th:each="ev : ${liveEvents}" th:attr="data-tags=${ev.eventTypeTag}">
                        <a th:href="@{/{eventType}/{id}(eventType=${ev.eventType.name().toLowerCase()}, id=${ev.id})}"
                           style="text-decoration: none; color: inherit;">
                            <img class="event-cover" th:src="${ev.imageUrl}" th:alt="${ev.title}"/>
                            <div class="card-body">
                                <h3 class="card-title" th:text="${ev.title}">Event title</h3>
                                <p class="card-meta" th:text="${ev.city + ' ‚Ä¢ Today ‚Ä¢ ' + ev.durationLabel}">City ‚Ä¢ Today ‚Ä¢
                                    Duration</p>
                                <p class="event-org" th:text="${'Organizer: ' + ev.organizer}">Organizer: ...</p>

                                <div class="capacity">
                                    <div class="capacity-row">
                                        <span th:text="${'Registered: ' + ev.registered + ' / ' + ev.capacity}">Registered: 0 / 0</span>
                                        <span class="capacity-mini"
                                              th:text="${'Price: ' + ev.priceLabel}">Price: Free</span>
                                    </div>
                                </div>
                            </div>

                            <div class="event-tags">
                                <span class="tag" th:text="${'#' + ev.eventTypeTag}">Tag</span>
                                <span class="badge badge-live">Live</span>
                            </div>
                        </a>
                    </article>
                </div>
            </div>

            <div class="grid grid-3" th:if="${#lists.isEmpty(liveEvents)}">
                Card 1
                <article class="event-card" data-tags="Music">
                    <img src="/img/event1.jpg" alt="Acoustic Night" class="event-cover"/>
                    <div class="card-body">
                        <h3 class="card-title">Acoustic Night</h3>
                        <p class="card-meta">HCM ‚Ä¢ Today ‚Ä¢ 2h</p>
                        <p class="event-org">Organizer: Music Club</p>
                        <div class="capacity">
                            <div class="capacity-row">
                                <span>Registered: 216 / 300</span>
                                <span class="capacity-mini">Price: Free</span>
                            </div>
                            <div class="bar">
                                <div class="fill" style="width:72%"></div>
                            </div>
                        </div>
                        <div class="event-tags">
                            <span class="tag">#Music</span>
                            <span class="tag">#Free</span>
                            <span class="badge badge-live">Live</span>
                        </div>
                    </div>
                </article>

                <article class="event-card" data-tags="Workshop">
                    <img src="/img/event2.jpg" alt="AI Workshop" class="event-cover"/>
                    <div class="card-body">
                        <h3 class="card-title">AI Workshop</h3>
                        <p class="card-meta">H√† N·ªôi ‚Ä¢ Today ‚Ä¢ 1h</p>
                        <p class="event-org">Organizer: GDSC</p>
                        <div class="capacity">
                            <div class="capacity-row">
                                <span>Registered: 110 / 200</span>
                                <span class="capacity-mini">Price: 50k</span>
                            </div>
                            <div class="bar">
                                <div class="fill" style="width:55%"></div>
                            </div>
                        </div>
                        <div class="event-tags">
                            <span class="tag">#Workshop</span>
                            <span class="badge badge-live">Live</span>
                        </div>
                    </div>
                </article>

                <article class="event-card" data-tags="Conference">
                    <img src="/img/event3.jpg" alt="Tech Summit" class="event-cover"/>
                    <div class="card-body">
                        <h3 class="card-title">Tech Summit</h3>
                        <p class="card-meta">ƒê√† N·∫µng ‚Ä¢ Today ‚Ä¢ 3h</p>
                        <p class="event-org">Organizer: Biz Club</p>
                        <div class="capacity">
                            <div class="capacity-row">
                                <span>Registered: 352 / 400</span>
                                <span class="capacity-mini">Price: 200k</span>
                            </div>
                            <div class="bar">
                                <div class="fill" style="width:88%"></div>
                            </div>
                        </div>
                        <div class="event-tags">
                            <span class="tag">#Conference</span>
                            <span class="badge badge-live">Live</span>
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </section>


    <!--    top student -->
    <section class="section section-muted">
        <div class="container">
            <div class="honor-frame">
                <div class="filter-row honor-head">
                  <span class="filter-label">
                      <span class="section-icon">üèÜ</span>
                      Top Outstanding Students
                  </span>
                </div>

                <div class="podium-layout">
                    <!-- Slot 2 - Rank 2 (Left, Medium height) -->
                    <div class="podium-slot slot-second" th:if="${topStudents != null and !topStudents.isEmpty() and topStudents.size() >= 2}">
                        <div class="slot-number" th:text="${topStudents[1]?.rank ?: 2}">2</div>
                        <div class="featured-card rank-2">
                            <div class="rank-badge">ü•à No.<span th:text="${topStudents[1]?.rank ?: 2}">2</span></div>

                            <div class="card-header">
                                <span class="card-title-small">OUTSTANDING</span>
                            </div>

                            <div class="student-image-container">
                                <img th:src="@{${topStudents[1]?.imageUrl ?: '/img/sinhvien2.jpg'}}"
                                     th:alt="${topStudents[1]?.name ?: 'Student'}"
                                     class="student-image"/>
                                <div class="background-graphic"></div>
                            </div>

                            <div class="card-footer">
                                <div class="student-title" th:text="${topStudents[1]?.organization ?: 'Student'}">Organization</div>
                                <div class="student-name" th:text="${topStudents[1]?.name ?: 'Ch∆∞a c√≥ d·ªØ li·ªáu'}">STUDENT NAME</div>
                                <div class="event-stats" th:text="${(topStudents[1]?.points ?: 0) + ' Points'}">0 Points</div>
                            </div>

                            <div class="decorative-elements">
                                <span class="deco-icon">‚úï</span>
                                <span class="deco-icon">‚úï</span>
                                <span class="deco-icon">‚úï</span>
                                <span class="deco-icon">‚úï</span>
                            </div>
                        </div>
                    </div>

                    <!-- Slot 1 - Rank 1 (Center, Highest) -->
                    <div class="podium-slot slot-first" th:if="${topStudents != null and !topStudents.isEmpty()}">
                        <div class="slot-number" th:text="${topStudents[0]?.rank ?: 1}">1</div>
                        <div class="featured-card rank-1">
                            <div class="rank-badge">ü•á No.<span th:text="${topStudents[0]?.rank ?: 1}">1</span></div>

                            <div class="card-header">
                                <span class="card-title-small">OUTSTANDING</span>
                            </div>

                            <div class="student-image-container">
                                <img th:src="@{${topStudents[0]?.imageUrl ?: '/img/sinhvien2.jpg'}}"
                                     th:alt="${topStudents[0]?.name ?: 'Student'}"
                                     class="student-image"/>
                                <div class="background-graphic"></div>
                            </div>

                            <div class="card-footer">
                                <div class="student-title" th:text="${topStudents[0]?.organization ?: 'Student'}">Organization</div>
                                <div class="student-name" th:text="${topStudents[0]?.name ?: 'Ch∆∞a c√≥ d·ªØ li·ªáu'}">STUDENT NAME</div>
                                <div class="event-stats" th:text="${(topStudents[0]?.points ?: 0) + ' Points'}">0 Points</div>
                            </div>

                            <div class="decorative-elements">
                                <span class="deco-icon">‚úï</span>
                                <span class="deco-icon">‚úï</span>
                                <span class="deco-icon">‚úï</span>
                                <span class="deco-icon">‚úï</span>
                            </div>
                        </div>
                    </div>

                    <!-- Slot 3 - Rank 3 (Right, Lowest) -->
                    <div class="podium-slot slot-third" th:if="${topStudents != null and !topStudents.isEmpty() and topStudents.size() >= 3}">
                        <div class="slot-number" th:text="${topStudents[2]?.rank ?: 3}">3</div>
                        <div class="featured-card rank-3">
                            <div class="rank-badge">ü•â No.<span th:text="${topStudents[2]?.rank ?: 3}">3</span></div>

                            <div class="card-header">
                                <span class="card-title-small">OUTSTANDING</span>
                            </div>

                            <div class="student-image-container">
                                <img th:src="@{${topStudents[2]?.imageUrl ?: '/img/sinhvien2.jpg'}}"
                                     th:alt="${topStudents[2]?.name ?: 'Student'}"
                                     class="student-image"/>
                                <div class="background-graphic"></div>
                            </div>

                            <div class="card-footer">
                                <div class="student-title" th:text="${topStudents[2]?.organization ?: 'Student'}">Organization</div>
                                <div class="student-name" th:text="${topStudents[2]?.name ?: 'Ch∆∞a c√≥ d·ªØ li·ªáu'}">STUDENT NAME</div>
                                <div class="event-stats" th:text="${(topStudents[2]?.points ?: 0) + ' Points'}">0 Points</div>
                            </div>

                            <div class="decorative-elements">
                                <span class="deco-icon">‚úï</span>
                                <span class="deco-icon">‚úï</span>
                                <span class="deco-icon">‚úï</span>
                                <span class="deco-icon">‚úï</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="section">
        <div class="container">
            <div class="filter-row">
                  <span class="filter-label">
                      <span class="section-icon">üí°</span>
                      Recommended for You
                  </span>
                <div class="chip-group">
                    <button class="chip is-active" data-reco="for-you">For you</button>
                    <button class="chip" data-reco="near-you">Near you</button>
                    <button class="chip" data-reco="trending">Trending</button>
                    <button class="chip" data-reco="free">Free</button>
                </div>
            </div>

            <div class="grid grid-3" th:if="${!#lists.isEmpty(recommendedEvents)}">
                <article class="event-card" th:each="event : ${recommendedEvents}">
                    <a th:href="@{/{eventType}/{id}(eventType=${event.eventType.name().toLowerCase()}, id=${event.id})}"
                       style="text-decoration: none; color: inherit;">
                        <img class="event-cover" th:src="${event.imageUrl}" th:alt="${event.title}"/>
                        <div class="card-body">
                            <h3 class="card-title" th:text="${event.title}">Event title</h3>
                            <p class="card-meta"
                               th:text="${event.city + ' ‚Ä¢ ' + event.dateLabel + ' ‚Ä¢ ' + event.durationLabel}">
                                City ‚Ä¢ Date ‚Ä¢ Duration
                            </p>
                            <p class="event-org" th:text="${'Organizer: ' + event.organizer}">Organizer: ...</p>

                            <div class="capacity">
                                <div class="capacity-row">
                                    <span th:text="${'Registered: ' + event.registered + ' / ' + event.capacity}">
                                        Registered: 0 / 0
                                    </span>
                                    <span class="capacity-mini"
                                          th:text="${'Price: ' + event.priceLabel}">Price: Free</span>
                                </div>
                            </div>

                            <div class="event-tags">
                                <span class="tag" th:text="${'#' + event.eventTypeTag}">#Tag</span>
                                <span class="badge badge-live" th:if="${event.live}">Live</span>
                                <span class="tag" th:if="${event.soldOut}">Sold Out</span>
                            </div>
                        </div>
                    </a>
                </article>
            </div>

            <div class="grid grid-3" th:if="${#lists.isEmpty(recommendedEvents)}">
                <article class="event-card">
                    <img src="/img/event2.jpg" alt="T√™n s·ª± ki·ªán" class="event-cover"/>
                    <div class="card-body">
                        <h3 class="card-title">Data Viz 101</h3>
                        <p class="card-meta">H√† N·ªôi ‚Ä¢ 28/09/2025 ‚Ä¢ 2h</p>
                        <p class="event-org">Organizer: DS Club</p>
                        <div class="capacity">
                            <div class="capacity-row">
                                <span>Registered: 120 / 200</span>
                                <span class="capacity-mini">Price: 70k</span>
                            </div>
                            <div class="bar">
                                <div class="fill" style="width:60%"></div>
                            </div>
                        </div>
                        <div class="event-tags">
                            <span class="tag">#Workshop</span>
                        </div>
                    </div>
                </article>

                <article class="event-card">
                    <img src="/img/event1.jpg" alt="T√™n s·ª± ki·ªán" class="event-cover"/>
                    <div class="card-body">
                        <h3 class="card-title">Startup Night</h3>
                        <p class="card-meta">HCM ‚Ä¢ 30/09/2025 ‚Ä¢ 2.5h</p>
                        <p class="event-org">Organizer: Startup Hub</p>
                        <div class="capacity">
                            <div class="capacity-row">
                                <span>Registered: 300 / 500</span>
                                <span class="capacity-mini">Price: Free</span>
                            </div>
                            <div class="bar">
                                <div class="fill" style="width:60%"></div>
                            </div>
                        </div>
                        <div class="event-tags">
                            <span class="tag">#Conference</span>
                            <span class="tag">#Free</span>
                        </div>
                    </div>
                </article>

                <article class="event-card">
                    <img src="/img/event3.jpg" alt="T√™n s·ª± ki·ªán" class="event-cover"/>
                    <div class="card-body">
                        <h3 class="card-title">Campus Coding Jam</h3>
                        <p class="card-meta">ƒê√† N·∫µng ‚Ä¢ 05/10/2025 ‚Ä¢ 3h</p>
                        <p class="event-org">Organizer: Biz Club</p>
                        <div class="capacity">
                            <div class="capacity-row">
                                <span>Registered: 150 / 180</span>
                                <span class="capacity-mini">Price: 120k</span>
                            </div>
                            <div class="bar">
                                <div class="fill" style="width:83%"></div>
                            </div>
                        </div>
                        <div class="event-tags">
                            <span class="tag">#Competition</span>
                        </div>
                    </div>
                </article>
            </div>

            <div class="carousel-nav">
                <button class="icon-btn" id="recoPrev" aria-label="Prev">‚Äπ</button>
                <button class="icon-btn" id="recoNext" aria-label="Next">‚Ä∫</button>
            </div>
        </div>
    </section>


</main>

<script>
    // Check check-in status for all events when page loads
    document.addEventListener('DOMContentLoaded', function() {
        const checkinSections = document.querySelectorAll('.checkin-section');
        
        checkinSections.forEach(function(section) {
            const eventId = section.getAttribute('data-event-id');
            if (!eventId) return;
            
            // Check check-in status
            fetch('/events/' + eventId + '/checkin-status', {
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                const statusDiv = document.getElementById('checkin-status-' + eventId);
                const badge = statusDiv.querySelector('.checkin-badge');
                const buttons = section.querySelector('.checkin-buttons');
                const successMessage = document.getElementById('checkin-success-' + eventId);
                
                if (data.checkedIn) {
                    // Show checked-in badge
                    badge.style.display = 'inline-block';
                    badge.textContent = '‚úì ƒê√£ check-in';
                    if (data.checkInTime) {
                        badge.textContent += ' (' + new Date(data.checkInTime).toLocaleString('vi-VN') + ')';
                    }
                    // ‚úÖ ·∫®n n√∫t check-in v√† hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
                    if (buttons) {
                        buttons.style.display = 'none';
                    }
                    if (successMessage) {
                        successMessage.style.display = 'block';
                    }
                } else {
                    // Hide badge, show buttons normally
                    badge.style.display = 'none';
                    if (buttons) {
                        buttons.style.display = 'flex';
                    }
                    if (successMessage) {
                        successMessage.style.display = 'none';
                    }
                }

                // ‚úÖ Ki·ªÉm tra localStorage ƒë·ªÉ ·∫©n n√∫t n·∫øu ƒë√£ check-in t·ª´ trang face-checkin
                const checkinKey = 'checkin_success_' + eventId;
                if (localStorage.getItem(checkinKey) === 'true') {
                    // ·∫®n n√∫t check-in
                    if (buttons) {
                        buttons.style.display = 'none';
                    }
                    // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
                    if (successMessage) {
                        successMessage.style.display = 'block';
                    }
                    // Hi·ªÉn th·ªã badge ƒë√£ check-in
                    if (badge) {
                        badge.style.display = 'inline-block';
                        badge.textContent = '‚úì ƒê√£ check-in';
                    }
                    // X√≥a key kh·ªèi localStorage
                    localStorage.removeItem(checkinKey);
                }
            })
            .catch(error => {
                console.error('Error checking check-in status for event ' + eventId + ':', error);
            });
        });

        // ‚úÖ L·∫Øng nghe message t·ª´ trang face-checkin ƒë·ªÉ ·∫©n n√∫t check-in
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'CHECKIN_SUCCESS') {
                const eventId = event.data.eventId;
                // T√¨m v√† ·∫©n n√∫t check-in cho event n√†y
                const checkinSection = document.querySelector(`[data-event-id="${eventId}"]`);
                if (checkinSection) {
                    const checkinButtons = checkinSection.querySelector('.checkin-buttons');
                    const successMessage = document.getElementById('checkin-success-' + eventId);
                    if (checkinButtons) {
                        checkinButtons.style.display = 'none';
                    }
                    // ‚úÖ Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
                    if (successMessage) {
                        successMessage.style.display = 'block';
                    }
                    // Hi·ªÉn th·ªã badge ƒë√£ check-in
                    const statusDiv = document.getElementById('checkin-status-' + eventId);
                    if (statusDiv) {
                        const checkinBadge = statusDiv.querySelector('.checkin-badge');
                        if (checkinBadge) {
                            checkinBadge.style.display = 'inline-block';
                            checkinBadge.textContent = '‚úì ƒê√£ check-in';
                        }
                    }
                }
            }
        });
    });
</script>
</body>
</html>