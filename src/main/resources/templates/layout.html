<!-- templates/layout.html -->
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head(${pageTitle})}"></head>

<body class="page-bg" th:attr="data-user-id=${uid}">
<!-- FRAGMENT LAYOUT: nhận content, activeMenu, uid -->
<th:block th:fragment="layout(content, activeMenu, uid)">
    <header th:replace="~{fragments/header :: siteHeader(${activeMenu})}"></header>

    <main class="page-main">
        <th:block th:replace="${content}"></th:block>
    </main>

    <footer th:replace="~{fragments/footer :: siteFooter()}"></footer>

    <!-- WebSocket Libraries for Realtime Notifications -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>


    <!-- Chatbot Integration -->
    <!-- Chatbot: hiển thị cho TẤT CẢ người dùng (kể cả chưa đăng nhập, trừ trang login) -->
    <!-- Note: Trang login (security/login.html) không dùng layout.html nên tự động không có chatbot -->
    <div id="openevent-chatbot-container"></div>
    <th:block>
        <!-- Luôn render chatbot fragment (chatbot.js sẽ xử lý logic khi chưa đăng nhập) -->
        <div th:replace="~{fragments/chatbot :: chatbot(${uid != null ? uid : null})}"></div>
    </th:block>

    <!-- Scripts -->
    <!-- Luôn load chatbot.js (chatbot.js sẽ tự xử lý khi chưa đăng nhập) -->
    <script th:src="@{/js/chatbot.js(v=4)}" defer></script>
    <script th:src="@{/js/main.js}" defer></script>
</th:block>
</body>
</html>