<!DOCTYPE html>
<html lang="vi">
<head>
	<meta charset="UTF-8">
	<title>Auth - OpenEvent</title>
</head>
<body>
<<<<<<< HEAD
<h1>Xác thực tài khoản</h1>
<p>Đăng ký tài khoản mới hoặc đăng nhập tài khoản đã có.</p>

<h2>Đăng ký</h2>
<p><strong>Lưu ý:</strong> Tài khoản mới sẽ có role CUSTOMER. Bạn có thể chuyển đổi sang HOST sau khi đăng nhập.</p>

<form id="registerForm">
	<label>Email: <input type="email" id="regEmail" required></label><br>
	<label>Mật khẩu: <input type="password" id="regPassword" required></label>
	<label><input type="checkbox" id="regShowPw"> Hiện mật khẩu</label><br>
	<label>SĐT: <input type="text" id="regPhone"></label><br>
	<label>Tổ chức (nếu có): <input type="text" id="regOrg"></label><br>
	<button type="submit" id="regBtn">Đăng ký</button>
	<button type="button" id="clearReg">Xóa form</button>
</form>
<pre id="registerResult"></pre>

<hr>

<h2>Đăng nhập</h2>
<form id="loginForm">
	<label>Email: <input type="email" id="loginEmail" required></label><br>
	<label>Mật khẩu: <input type="password" id="loginPassword" required></label>
	<label><input type="checkbox" id="loginShowPw"> Hiện mật khẩu</label><br>
	<button type="submit" id="loginBtn">Đăng nhập</button>
	<button type="button" id="adminQuick">Đăng nhập nhanh Admin</button>
</form>
<pre id="loginResult"></pre>

<p><a href="/static">Về trang chủ</a></p>

<script>
	function pretty(objOrText) {
		try {
			const obj = typeof objOrText === 'string' ? JSON.parse(objOrText) : objOrText;
			return JSON.stringify(obj, null, 2);
		} catch (_) {
			return String(objOrText);
		}
	}

	function setLoading(btn, loading) {
		if (!btn) return;
		btn.disabled = !!loading;
		btn.textContent = loading ? (btn.id === 'regBtn' ? 'Đang đăng ký...' : 'Đang đăng nhập...') : (btn.id === 'regBtn' ? 'Đăng ký' : 'Đăng nhập');
	}

	document.getElementById('regShowPw').addEventListener('change', (e) => {
		document.getElementById('regPassword').type = e.target.checked ? 'text' : 'password';
	});
	document.getElementById('loginShowPw').addEventListener('change', (e) => {
		document.getElementById('loginPassword').type = e.target.checked ? 'text' : 'password';
	});

	document.getElementById('clearReg').addEventListener('click', () => {
		document.getElementById('registerForm').reset();
		document.getElementById('registerResult').textContent = '';
	});

	async function handleRegister(e) {
		e.preventDefault();
		const btn = document.getElementById('regBtn');
		setLoading(btn, true);

		const payload = {
			email: document.getElementById('regEmail').value,
			password: document.getElementById('regPassword').value,
			phoneNumber: document.getElementById('regPhone').value || null,
			organization: document.getElementById('regOrg').value || null
		};

		try {
			const res = await fetch('/api/auth/register', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				credentials: 'include',
				body: JSON.stringify(payload)
			});

			const text = await res.text();
			if (!res.ok) {
				document.getElementById('registerResult').textContent = 'Lỗi đăng ký (' + res.status + '):\n' + text;
			} else {
				document.getElementById('registerResult').textContent = pretty(text);
				try {
					const json = JSON.parse(text);
					if (json.redirectPath) window.location.href = json.redirectPath;
				} catch (_) {}
			}
		} catch (err) {
			document.getElementById('registerResult').textContent = 'Lỗi: ' + err;
		} finally {
			setLoading(btn, false);
		}
	}

	async function handleLogin(e) {
		e.preventDefault();
		const btn = document.getElementById('loginBtn');
		setLoading(btn, true);
		const payload = {
			email: document.getElementById('loginEmail').value,
			password: document.getElementById('loginPassword').value
		};
		try {
			const res = await fetch('/api/auth/login', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				credentials: 'include',
				body: JSON.stringify(payload)
			});
			const text = await res.text();
			if (!res.ok) {
				document.getElementById('loginResult').textContent = 'Lỗi đăng nhập (' + res.status + '):\n' + text;
			} else {
				document.getElementById('loginResult').textContent = pretty(text);
				try {
					const json = JSON.parse(text);
					if (json.redirectPath) window.location.href = json.redirectPath;
				} catch (_) {}
			}
		} catch (err) {
			document.getElementById('loginResult').textContent = 'Lỗi: ' + err;
		} finally {
			setLoading(btn, false);
		}
	}

	document.getElementById('adminQuick').addEventListener('click', () => {
		document.getElementById('loginEmail').value = 'admin@gmail.com';
		document.getElementById('loginPassword').value = '123456';
		document.getElementById('loginForm').dispatchEvent(new Event('submit'));
	});

	document.getElementById('registerForm').addEventListener('submit', handleRegister);
	document.getElementById('loginForm').addEventListener('submit', handleLogin);
</script>
</body>
</html>
=======
	<h1>Xác thực tài khoản</h1>
	<p>Đăng ký tài khoản mới (CUSTOMER, SPONSOR, TEACHER) hoặc đăng nhập tài khoản đã có.</p>

	<h2>Đăng ký</h2>
	<form id="registerForm">
		<label>Email: <input type="email" id="regEmail" required></label><br>
		<label>Mật khẩu: <input type="password" id="regPassword" required></label>
		<label><input type="checkbox" id="regShowPw"> Hiện mật khẩu</label><br>
		<label>Role:
			<select id="regRole">
				<option value="CUSTOMER">CUSTOMER</option>
				<option value="SPONSOR">SPONSOR</option>
				<option value="TEACHER">TEACHER</option>
			</select>
		</label><br>
		<label>SĐT: <input type="text" id="regPhone"></label><br>
		<label>Tổ chức (nếu có): <input type="text" id="regOrg"></label><br>
		<button type="submit" id="regBtn">Đăng ký</button>
		<button type="button" id="clearReg">Xóa form</button>
	</form>
	<pre id="registerResult"></pre>

	<hr>

	<h2>Đăng nhập</h2>
	<form id="loginForm">
		<label>Email: <input type="email" id="loginEmail" required></label><br>
		<label>Mật khẩu: <input type="password" id="loginPassword" required></label>
		<label><input type="checkbox" id="loginShowPw"> Hiện mật khẩu</label><br>
		<button type="submit" id="loginBtn">Đăng nhập</button>
		<button type="button" id="adminQuick">Đăng nhập nhanh Admin</button>
	</form>
	<pre id="loginResult"></pre>

	<p><a href="/static">Về trang chủ</a></p>

	<script>
		function pretty(objOrText) {
			try {
				const obj = typeof objOrText === 'string' ? JSON.parse(objOrText) : objOrText;
				return JSON.stringify(obj, null, 2);
			} catch (_) {
				return String(objOrText);
			}
		}

		function setLoading(btn, loading) {
			if (!btn) return;
			btn.disabled = !!loading;
			btn.textContent = loading ? (btn.id === 'regBtn' ? 'Đang đăng ký...' : 'Đang đăng nhập...') : (btn.id === 'regBtn' ? 'Đăng ký' : 'Đăng nhập');
		}

		document.getElementById('regShowPw').addEventListener('change', (e) => {
			document.getElementById('regPassword').type = e.target.checked ? 'text' : 'password';
		});
		document.getElementById('loginShowPw').addEventListener('change', (e) => {
			document.getElementById('loginPassword').type = e.target.checked ? 'text' : 'password';
		});

		document.getElementById('clearReg').addEventListener('click', () => {
			document.getElementById('registerForm').reset();
			document.getElementById('registerResult').textContent = '';
		});

		async function handleRegister(e) {
			e.preventDefault();
			const btn = document.getElementById('regBtn');
			setLoading(btn, true);
			const payload = {
				email: document.getElementById('regEmail').value,
				password: document.getElementById('regPassword').value,
				role: document.getElementById('regRole').value,
				phoneNumber: document.getElementById('regPhone').value || null,
				organization: document.getElementById('regOrg').value || null
			};
			try {
				const res = await fetch('/api/auth/register', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					credentials: 'include',
					body: JSON.stringify(payload)
				});
				const text = await res.text();
				if (!res.ok) {
					document.getElementById('registerResult').textContent = 'Lỗi đăng ký (' + res.status + '):\n' + text;
				} else {
					document.getElementById('registerResult').textContent = pretty(text);
					try {
						const json = JSON.parse(text);
						if (json.redirectPath) window.location.href = json.redirectPath;
					} catch (_) {}
				}
			} catch (err) {
				document.getElementById('registerResult').textContent = 'Lỗi: ' + err;
			} finally {
				setLoading(btn, false);
			}
		}

		async function handleLogin(e) {
			e.preventDefault();
			const btn = document.getElementById('loginBtn');
			setLoading(btn, true);
			const payload = {
				email: document.getElementById('loginEmail').value,
				password: document.getElementById('loginPassword').value
			};
			try {
				const res = await fetch('/api/auth/login', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					credentials: 'include',
					body: JSON.stringify(payload)
				});
				const text = await res.text();
				if (!res.ok) {
					document.getElementById('loginResult').textContent = 'Lỗi đăng nhập (' + res.status + '):\n' + text;
				} else {
					document.getElementById('loginResult').textContent = pretty(text);
					try {
						const json = JSON.parse(text);
						if (json.redirectPath) window.location.href = json.redirectPath;
					} catch (_) {}
				}
			} catch (err) {
				document.getElementById('loginResult').textContent = 'Lỗi: ' + err;
			} finally {
				setLoading(btn, false);
			}
		}

		document.getElementById('adminQuick').addEventListener('click', () => {
			document.getElementById('loginEmail').value = 'admin@gmail.com';
			document.getElementById('loginPassword').value = '123456';
			document.getElementById('loginForm').dispatchEvent(new Event('submit'));
		});

		document.getElementById('registerForm').addEventListener('submit', handleRegister);
		document.getElementById('loginForm').addEventListener('submit', handleLogin);
	</script>
</body>
</html> 
>>>>>>> duc
