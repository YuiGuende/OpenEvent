<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ÄÄƒng nháº­p - OpenEvent</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link th:href="@{/css/login.css}" rel="stylesheet">
</head>
<body>
<div class="container">

    <div class="form-box login">
        <form id="loginForm" th:action="@{/perform_login}" method="post">
            <input type="hidden" name="redirectUrl" th:value="${redirectUrl}" th:if="${redirectUrl != null}">
            <input type="hidden" name="checkinEventId" th:value="${param.eventId[0]}" th:if="${param.eventId != null}">
            <input type="hidden" name="checkinAction" th:value="${param.action[0]}" th:if="${param.action != null}">
            <h1>ÄÄƒng nháº­p</h1>
            
            <!-- Check-in notification -->
            <div th:if="${param.checkin != null}" class="checkin-notice">
                <div class="notice-content">
                    <h3>ğŸ« Check-in Event</h3>
                    <p th:text="'Sá»± kiá»‡n: ' + ${param.eventTitle[0]}">Sá»± kiá»‡n: Live Music Night</p>
                    <p th:text="'HÃ nh Ä‘á»™ng: ' + (${param.action[0]} == 'checkin' ? 'Check-in' : 'Check-out')">HÃ nh Ä‘á»™ng: Check-in</p>
                    <p class="notice-text">ÄÄƒng nháº­p Ä‘á»ƒ tá»± Ä‘á»™ng thá»±c hiá»‡n check-in/check-out</p>
                </div>
            </div>
            <div class="input-box">
                <input type="email" id="loginEmail" name="username" placeholder="Email" required>
                <i class='bx bx-customer'></i>
            </div>
            <div class="input-box">
                <input type="password" id="loginPassword" name="password" placeholder="Máº­t kháº©u" required>
                <i class='bx bx-show' id="toggleLoginPw" style="cursor: pointer;"></i>
            </div>

            <div class="forgot-link">
                <a href="#">QuÃªn máº­t kháº©u?</a>
            </div>
            <button type="submit" class="btn" id="loginBtn">ÄÄƒng nháº­p</button>
            <p>or login with social platforms</p>
            <div class="social-icons">
                <a th:href="@{/oauth2/authorization/google}"><i class='bx bxl-google'></i></a>
                <a th:href="@{/oauth2/authorization/facebook}"><i class='bx bxl-facebook'></i></a>
            </div>
            <div id="notice" class="notice"></div>
            <div id="loginResult" style="color: red; margin-top: 10px;"></div>
        </form>
    </div>

    <div class="form-box register">
        <form id="registerForm" th:action="@{/register}" method="post">
            <input type="hidden" name="redirectUrl" th:value="${redirectUrl}" th:if="${redirectUrl != null}">
            <input type="hidden" name="checkinEventId" th:value="${param.eventId[0]}" th:if="${param.eventId != null}">
            <input type="hidden" name="checkinAction" th:value="${param.action[0]}" th:if="${param.action != null}">
            <h1>ÄÄƒng kÃ½</h1>
            
            <!-- Check-in notification for register -->
            <div th:if="${param.checkin != null}" class="checkin-notice">
                <div class="notice-content">
                    <h3>ğŸ« Check-in Event</h3>
                    <p th:text="'Sá»± kiá»‡n: ' + ${param.eventTitle[0]}">Sá»± kiá»‡n: Live Music Night</p>
                    <p th:text="'HÃ nh Ä‘á»™ng: ' + (${param.action[0]} == 'checkin' ? 'Check-in' : 'Check-out')">HÃ nh Ä‘á»™ng: Check-in</p>
                    <p class="notice-text">ÄÄƒng kÃ½ tÃ i khoáº£n Ä‘á»ƒ tá»± Ä‘á»™ng thá»±c hiá»‡n check-in/check-out</p>
                </div>
            </div>
            <div class="input-box">
                <input type="email" id="regEmail" name="email" placeholder="Email" required>
                <i class='bx bxl-gmail'></i>
            </div>
            <div class="input-box">
                <input type="password" id="regPassword" name="password" placeholder="Máº­t kháº©u" required>
                <i class='bx bx-show' id="toggleRegPw" style="cursor: pointer;"></i>
            </div>

            <!-- Hidden input Ä‘á»ƒ gá»­i role máº·c Ä‘á»‹nh lÃ  CUSTOMER -->
            <input type="hidden" name="role" value="CUSTOMER">

            <div class="input-box">
                <input type="text" id="regPhone" name="phone" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i" required>
                <i class='bx bx-phone'></i>
            </div>
            <button type="submit" class="btn" id="regBtn">ÄÄƒng kÃ½</button>
            <div id="registerResult" style="color: red; margin-top: 10px;"></div>
        </form>
    </div>

    <div class="toggle-box">
        <div class="toggle-panel toggle-left">
            <h1 class="wellcome-title">Hello, Welcome !</h1>
            <p>ChÆ°a cÃ³ tÃ i khoáº£n Ã  ??</p>
            <button class="btn register-btn">ÄÄƒng kÃ½</button>
        </div>
        <div class="toggle-panel toggle-right">
            <h1 class="wellcome-title">Welcome Back !</h1>
            <p> CÃ³ tÃ i khoáº£n rá»“i Ã  ??</p>
            <button class="btn login-btn">ÄÄƒng nháº­p</button>
        </div>
    </div>
</div>

<script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
<!--<script th:src="@{/js/login.js}"></script>-->
<!--<script th:src="@{/js/register.js}"></script>-->
<script th:src="@{/js/auth.js}"></script>

    <style>
        .checkin-notice {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .checkin-notice h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        
        .checkin-notice p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .notice-text {
            font-style: italic;
            opacity: 0.9;
        }
    </style>

    <script>
    function getQueryParam(name) {
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
    }

    // Show registration success notice
    (function showNotice() {
        if (getQueryParam('registered') === '1') {
            const notice = document.getElementById('notice');
            notice.textContent = 'Registration successful! Please login.';
            notice.style.color = 'green';
            notice.style.display = 'block';
        }
    })();
</script>
</body>
</html>